<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Marriott Â· Review Intelligence</title>
<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@300;400;500;600;700&family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;1,9..40,300&display=swap" rel="stylesheet">
<style>
/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   VARIABLES & RESET
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
:root {
  --gold: #c9a84c;
  --gold-light: #e8c97a;
  --gold-dim: rgba(201,168,76,0.15);
  --gold-glow: rgba(201,168,76,0.35);

  /* Dark mode (default) */
  --bg: #080c10;
  --bg2: #0d1219;
  --bg3: #131b24;
  --surface: #0f1720;
  --surface2: #172030;
  --border: rgba(201,168,76,0.12);
  --border-strong: rgba(201,168,76,0.25);
  --text: #e8e2d6;
  --text-dim: #7a8a99;
  --text-muted: #445566;
  --positive: #4ecb71;
  --negative: #e85c5c;
  --neutral: #e8c97a;
  --shadow: 0 20px 60px rgba(0,0,0,0.6);
  --card-hover: rgba(201,168,76,0.04);
}

[data-theme="light"] {
  --bg: #f5f0e8;
  --bg2: #ece5d8;
  --bg3: #e5dcc8;
  --surface: #faf7f2;
  --surface2: #f0ebe0;
  --border: rgba(120,90,30,0.15);
  --border-strong: rgba(120,90,30,0.3);
  --text: #1a1409;
  --text-dim: #5a4e3c;
  --text-muted: #9a8e7c;
  --shadow: 0 20px 60px rgba(0,0,0,0.12);
  --card-hover: rgba(201,168,76,0.06);
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

html { font-size: 14px; }

body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100vh;
  overflow-x: hidden;
  cursor: none;
  transition: background 0.4s, color 0.4s;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CUSTOM CURSOR (antigravity)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#cursor-ring, #cursor-dot {
  position: fixed;
  pointer-events: none;
  z-index: 9999;
  transform: translate(-50%, -50%);
  border-radius: 50%;
  transition: transform 0.08s ease, opacity 0.3s;
}
#cursor-ring {
  width: 36px; height: 36px;
  border: 1.5px solid var(--gold);
  opacity: 0.6;
  transition: width 0.25s, height 0.25s, border-color 0.25s, opacity 0.25s;
}
#cursor-dot {
  width: 6px; height: 6px;
  background: var(--gold);
}
body[data-theme="dark"] #cursor-ring {
  box-shadow: 0 0 12px var(--gold-glow);
}
#cursor-ring.hover {
  width: 52px; height: 52px;
  border-color: var(--gold-light);
  opacity: 0.9;
}

/* Dark mode particle canvas */
#particle-canvas {
  position: fixed; top: 0; left: 0;
  pointer-events: none;
  z-index: 0;
  opacity: 0;
  transition: opacity 0.6s;
}
[data-theme="dark"] #particle-canvas { opacity: 1; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREENS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.screen { display: none; position: relative; z-index: 1; }
.screen.active { display: flex; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 1: LOGIN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-login {
  min-height: 100vh;
  align-items: center;
  justify-content: center;
  flex-direction: column;
  position: relative;
}

.login-bg-grid {
  position: fixed; inset: 0;
  background-image:
    linear-gradient(rgba(201,168,76,0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(201,168,76,0.05) 1px, transparent 1px);
  background-size: 60px 60px;
  pointer-events: none;
}
[data-theme="light"] .login-bg-grid {
  background-image:
    linear-gradient(rgba(100,70,10,0.05) 1px, transparent 1px),
    linear-gradient(90deg, rgba(100,70,10,0.05) 1px, transparent 1px);
}

.login-card {
  background: var(--surface);
  border: 1px solid var(--border-strong);
  border-radius: 20px;
  padding: 52px 44px;
  width: 420px;
  box-shadow: var(--shadow), 0 0 80px rgba(201,168,76,0.06);
  position: relative;
  animation: fadeUp 0.7s ease both;
}

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(30px); }
  to { opacity: 1; transform: translateY(0); }
}

.login-logo {
  text-align: center;
  margin-bottom: 36px;
}
.login-logo-m {
  font-family: 'Cormorant Garamond', serif;
  font-size: 52px;
  font-weight: 300;
  color: var(--gold);
  line-height: 1;
  letter-spacing: -2px;
}
.login-logo-brand {
  font-family: 'Cormorant Garamond', serif;
  font-size: 14px;
  font-weight: 500;
  letter-spacing: 5px;
  color: var(--text-dim);
  text-transform: uppercase;
  margin-top: 4px;
}
.login-logo-sub {
  font-size: 10px;
  letter-spacing: 3px;
  color: var(--text-muted);
  text-transform: uppercase;
  margin-top: 8px;
}

.login-divider {
  width: 40px; height: 1px;
  background: var(--gold);
  margin: 16px auto;
  opacity: 0.4;
}

.form-group { margin-bottom: 18px; }
.form-label {
  font-size: 10px;
  letter-spacing: 2px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-bottom: 8px;
  display: block;
}
.form-input {
  width: 100%;
  padding: 13px 16px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 14px;
  outline: none;
  transition: border-color 0.2s, box-shadow 0.2s;
  cursor: none;
}
.form-input:focus {
  border-color: var(--gold);
  box-shadow: 0 0 0 3px var(--gold-dim);
}

.btn-login {
  width: 100%;
  padding: 14px;
  background: linear-gradient(135deg, #c9a84c, #a8833a);
  border: none;
  border-radius: 8px;
  color: #0d0a04;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  font-weight: 600;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  cursor: none;
  margin-top: 8px;
  transition: all 0.2s;
}
.btn-login:hover {
  transform: translateY(-1px);
  box-shadow: 0 8px 24px rgba(201,168,76,0.4);
}
.btn-login:active { transform: translateY(0); }

.login-hint {
  text-align: center;
  margin-top: 20px;
  font-size: 11px;
  color: var(--text-muted);
}
.login-hint span { color: var(--gold); }

.login-error {
  background: rgba(232,92,92,0.1);
  border: 1px solid rgba(232,92,92,0.3);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 12px;
  color: var(--negative);
  margin-bottom: 16px;
  display: none;
}
.login-error.show { display: block; }

/* Theme toggle */
.theme-toggle {
  position: fixed; top: 20px; right: 20px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 50px;
  padding: 8px 14px;
  display: flex; align-items: center; gap: 8px;
  cursor: none;
  z-index: 100;
  font-size: 12px;
  color: var(--text-dim);
  transition: all 0.2s;
}
.theme-toggle:hover { border-color: var(--gold); color: var(--text); }
.theme-toggle-icon { font-size: 14px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 2: SEARCH
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-search {
  min-height: 100vh;
  flex-direction: column;
}

/* Sidebar */
.sidebar {
  position: fixed; left: 0; top: 0; bottom: 0;
  width: 240px;
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column;
  z-index: 50;
  transition: background 0.4s, border-color 0.4s;
}

.sidebar-brand {
  padding: 28px 24px 20px;
  border-bottom: 1px solid var(--border);
}
.sidebar-brand-m {
  font-family: 'Cormorant Garamond', serif;
  font-size: 28px;
  font-weight: 300;
  color: var(--gold);
  letter-spacing: -1px;
}
.sidebar-brand-name {
  font-size: 11px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--text-dim);
  margin-top: 2px;
}

.sidebar-nav { flex: 1; padding: 20px 12px; overflow-y: auto; }
.nav-section-label {
  font-size: 9px;
  letter-spacing: 2.5px;
  text-transform: uppercase;
  color: var(--text-muted);
  padding: 0 12px;
  margin: 20px 0 8px;
}
.nav-section-label:first-child { margin-top: 0; }

.nav-item {
  display: flex; align-items: center; gap: 12px;
  padding: 10px 12px;
  border-radius: 8px;
  cursor: none;
  color: var(--text-dim);
  font-size: 13px;
  font-weight: 400;
  transition: all 0.15s;
  position: relative;
}
.nav-item:hover { background: var(--bg3); color: var(--text); }
.nav-item.active {
  background: var(--gold-dim);
  color: var(--gold-light);
  font-weight: 500;
}
.nav-item.active::before {
  content: '';
  position: absolute; left: 0; top: 25%; bottom: 25%;
  width: 2px;
  background: var(--gold);
  border-radius: 2px;
}
.nav-icon { font-size: 15px; }
.nav-badge {
  margin-left: auto;
  background: var(--negative);
  color: #fff;
  font-size: 9px;
  padding: 2px 6px;
  border-radius: 10px;
  font-weight: 600;
}

.sidebar-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  font-size: 10px;
  color: var(--text-muted);
}
.sidebar-user {
  display: flex; align-items: center; gap: 10px;
  margin-bottom: 8px;
}
.sidebar-avatar {
  width: 28px; height: 28px;
  background: var(--gold-dim);
  border: 1px solid var(--gold);
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 11px;
  font-weight: 600;
  color: var(--gold);
}
.sidebar-user-info { flex: 1; }
.sidebar-user-name { font-size: 12px; font-weight: 500; color: var(--text); }
.sidebar-user-role { font-size: 10px; color: var(--text-muted); }
.btn-logout {
  background: none;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 4px 10px;
  font-size: 10px;
  color: var(--text-dim);
  cursor: none;
  transition: all 0.15s;
}
.btn-logout:hover { border-color: var(--negative); color: var(--negative); }

/* Main content area */
.main-content {
  margin-left: 240px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
}

.topbar {
  padding: 20px 32px;
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  background: var(--surface);
  position: sticky; top: 0; z-index: 40;
}
.topbar-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px;
  font-weight: 500;
  color: var(--text);
}
.topbar-subtitle { font-size: 11px; color: var(--text-muted); margin-top: 1px; }
.topbar-actions { display: flex; align-items: center; gap: 12px; }

.page-content { padding: 32px; flex: 1; }

/* Search bar */
.search-wrap { max-width: 640px; margin: 0 auto 40px; }
.search-label {
  font-family: 'Cormorant Garamond', serif;
  font-size: 32px;
  font-weight: 400;
  text-align: center;
  color: var(--text);
  margin-bottom: 8px;
}
.search-sublabel {
  text-align: center;
  font-size: 12px;
  color: var(--text-muted);
  letter-spacing: 1px;
  margin-bottom: 24px;
}
.search-box {
  display: flex; align-items: center;
  background: var(--surface);
  border: 1px solid var(--border-strong);
  border-radius: 12px;
  padding: 0 16px;
  transition: border-color 0.2s, box-shadow 0.2s;
}
.search-box:focus-within {
  border-color: var(--gold);
  box-shadow: 0 0 0 3px var(--gold-dim);
}
.search-icon { font-size: 16px; margin-right: 10px; }
.search-input {
  flex: 1;
  padding: 14px 0;
  background: none;
  border: none;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 15px;
  outline: none;
  cursor: none;
}
.search-input::placeholder { color: var(--text-muted); }
.search-clear {
  background: none; border: none;
  color: var(--text-muted); cursor: none; font-size: 16px;
  padding: 4px; transition: color 0.15s;
}
.search-clear:hover { color: var(--text); }

/* Hotel grid */
.hotels-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
  gap: 20px;
  max-width: 1100px;
  margin: 0 auto;
}

.hotel-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  cursor: none;
  transition: all 0.25s;
  animation: fadeUp 0.5s ease both;
}
.hotel-card:hover {
  border-color: var(--gold);
  transform: translateY(-4px);
  box-shadow: 0 16px 48px rgba(0,0,0,0.3), 0 0 0 1px rgba(201,168,76,0.15);
}

.hotel-card-img {
  height: 140px;
  background: var(--bg3);
  position: relative;
  overflow: hidden;
  display: flex; align-items: center; justify-content: center;
}
.hotel-card-img-inner {
  width: 100%; height: 100%;
  background: linear-gradient(135deg, var(--bg3) 0%, var(--surface2) 100%);
  display: flex; align-items: center; justify-content: center;
  font-size: 40px;
  position: relative;
}
.hotel-card-img-inner::after {
  content: '';
  position: absolute; inset: 0;
  background: linear-gradient(to bottom, transparent 50%, rgba(0,0,0,0.4));
}
.hotel-card-source-badge {
  position: absolute; top: 10px; right: 10px;
  background: rgba(0,0,0,0.6);
  border: 1px solid var(--gold);
  border-radius: 20px;
  padding: 3px 10px;
  font-size: 9px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--gold);
  z-index: 2;
}
.hotel-card-body { padding: 18px; }
.hotel-card-name {
  font-family: 'Cormorant Garamond', serif;
  font-size: 17px;
  font-weight: 600;
  color: var(--text);
  margin-bottom: 4px;
  line-height: 1.3;
}
.hotel-card-loc {
  font-size: 11px;
  color: var(--text-muted);
  margin-bottom: 12px;
  display: flex; align-items: center; gap: 4px;
}
.hotel-card-stars {
  color: var(--gold);
  font-size: 13px;
  margin-bottom: 4px;
}
.hotel-card-meta {
  display: flex; align-items: center; justify-content: space-between;
  margin-top: 12px;
}
.hotel-card-rating {
  font-family: 'Cormorant Garamond', serif;
  font-size: 26px;
  font-weight: 600;
  color: var(--gold);
}
.hotel-card-review-count {
  font-size: 11px;
  color: var(--text-muted);
}
.hotel-card-cta {
  background: var(--gold-dim);
  border: 1px solid rgba(201,168,76,0.25);
  border-radius: 6px;
  padding: 6px 14px;
  font-size: 11px;
  font-weight: 600;
  color: var(--gold);
  letter-spacing: 0.5px;
  cursor: none;
  transition: all 0.15s;
}
.hotel-card:hover .hotel-card-cta {
  background: var(--gold);
  color: #0d0a04;
  border-color: var(--gold);
}

/* Loading spinner */
.loading {
  display: flex; flex-direction: column;
  align-items: center; justify-content: center;
  padding: 60px 20px;
  color: var(--text-muted);
  gap: 16px;
}
.spinner {
  width: 40px; height: 40px;
  border: 2px solid var(--border);
  border-top-color: var(--gold);
  border-radius: 50%;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SCREEN 3: HOTEL DETAIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#screen-detail {
  flex-direction: column;
}

.hotel-hero {
  background: var(--surface);
  border-bottom: 1px solid var(--border);
  padding: 32px 32px 0;
  margin-left: 240px;
  position: relative;
  overflow: hidden;
}
.hotel-hero::before {
  content: '';
  position: absolute; top: 0; right: 0;
  width: 400px; height: 100%;
  background: radial-gradient(ellipse at top right, var(--gold-dim) 0%, transparent 70%);
  pointer-events: none;
}
.hotel-hero-back {
  display: inline-flex; align-items: center; gap: 8px;
  font-size: 12px;
  color: var(--text-dim);
  cursor: none;
  margin-bottom: 20px;
  transition: color 0.15s;
}
.hotel-hero-back:hover { color: var(--gold); }

.hotel-hero-top {
  display: flex; align-items: flex-start; gap: 20px;
  margin-bottom: 24px;
}
.hotel-hero-icon {
  width: 64px; height: 64px;
  background: var(--gold-dim);
  border: 1px solid var(--gold);
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-size: 28px;
  flex-shrink: 0;
}
.hotel-hero-info { flex: 1; }
.hotel-hero-name {
  font-family: 'Cormorant Garamond', serif;
  font-size: 30px;
  font-weight: 600;
  color: var(--text);
  line-height: 1.15;
  margin-bottom: 4px;
}
.hotel-hero-location {
  font-size: 12px;
  color: var(--text-dim);
  margin-bottom: 10px;
  display: flex; align-items: center; gap: 5px;
}
.hotel-hero-stars { color: var(--gold); font-size: 15px; }
.hotel-hero-rating {
  font-family: 'Cormorant Garamond', serif;
  font-size: 38px;
  font-weight: 600;
  color: var(--gold);
  display: flex; align-items: baseline; gap: 6px;
}
.hotel-hero-rating-sub { font-size: 13px; font-weight: 300; color: var(--text-dim); }

.hotel-hero-stats {
  display: flex; gap: 32px;
  margin-bottom: 24px;
}
.hhs {
  text-align: center;
}
.hhs-val {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px;
  font-weight: 600;
  color: var(--text);
}
.hhs-label {
  font-size: 9px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--text-muted);
  margin-top: 2px;
}

/* Category tabs */
.category-tabs {
  display: flex; gap: 0;
  border-bottom: none;
}
.cat-tab {
  padding: 14px 28px;
  cursor: none;
  border-radius: 12px 12px 0 0;
  font-size: 13px;
  font-weight: 500;
  color: var(--text-dim);
  position: relative;
  transition: all 0.2s;
  display: flex; align-items: center; gap: 8px;
  border: 1px solid transparent;
  border-bottom: none;
  margin-bottom: -1px;
}
.cat-tab:hover { color: var(--text); background: var(--bg3); }
.cat-tab.active {
  color: var(--text);
  background: var(--bg);
  border-color: var(--border);
  border-bottom-color: var(--bg);
  z-index: 2;
}
.cat-tab-count {
  font-size: 10px;
  background: var(--gold-dim);
  color: var(--gold);
  padding: 1px 7px;
  border-radius: 10px;
  font-weight: 600;
}
.cat-tab.active .cat-tab-count {
  background: var(--gold);
  color: #0d0a04;
}

/* Detail content */
.detail-content {
  margin-left: 240px;
  padding: 32px;
  border-top: 1px solid var(--border);
  background: var(--bg);
  flex: 1;
}

/* Sentiment sub-tabs */
.sentiment-tabs {
  display: flex; gap: 8px;
  margin-bottom: 24px;
}
.sent-tab {
  padding: 8px 20px;
  border-radius: 50px;
  font-size: 12px;
  font-weight: 500;
  cursor: none;
  border: 1px solid var(--border);
  color: var(--text-dim);
  background: var(--surface);
  transition: all 0.15s;
  display: flex; align-items: center; gap: 7px;
}
.sent-tab:hover { border-color: var(--gold); color: var(--text); }
.sent-tab.active-all { border-color: var(--gold); background: var(--gold-dim); color: var(--gold); }
.sent-tab.active-positive { border-color: var(--positive); background: rgba(78,203,113,0.1); color: var(--positive); }
.sent-tab.active-negative { border-color: var(--negative); background: rgba(232,92,92,0.1); color: var(--negative); }
.sent-tab.active-neutral { border-color: var(--neutral); background: rgba(232,201,122,0.1); color: var(--neutral); }

.sent-indicator {
  width: 6px; height: 6px;
  border-radius: 50%;
}
.sent-indicator.positive { background: var(--positive); }
.sent-indicator.negative { background: var(--negative); }
.sent-indicator.neutral { background: var(--neutral); }
.sent-indicator.all { background: var(--gold); }

/* Reviews list */
.reviews-container { display: flex; flex-direction: column; gap: 14px; }

.review-card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px 22px;
  transition: all 0.2s;
  animation: fadeUp 0.4s ease both;
}
.review-card:hover {
  border-color: var(--border-strong);
  background: var(--surface2);
}
.review-card-top {
  display: flex; align-items: flex-start;
  justify-content: space-between;
  margin-bottom: 12px;
}
.review-author {
  display: flex; align-items: center; gap: 12px;
}
.review-avatar {
  width: 36px; height: 36px;
  border-radius: 50%;
  display: flex; align-items: center; justify-content: center;
  font-size: 12px;
  font-weight: 600;
  flex-shrink: 0;
}
.review-author-name { font-size: 13px; font-weight: 600; color: var(--text); }
.review-meta { font-size: 10px; color: var(--text-muted); margin-top: 2px; display: flex; align-items: center; gap: 8px; }
.review-right { display: flex; flex-direction: column; align-items: flex-end; gap: 6px; }
.review-stars { color: var(--gold); font-size: 13px; }
.review-source-badge {
  font-size: 9px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  padding: 2px 8px;
  border-radius: 10px;
  font-weight: 600;
}
.source-google { background: rgba(66,133,244,0.15); color: #4285f4; }
.source-tripadvisor { background: rgba(52,168,83,0.15); color: #34a853; }
.source-booking { background: rgba(0,113,187,0.15); color: #0071bb; }
.source-bookingcom { background: rgba(0,113,187,0.15); color: #0071bb; }
.source-agoda { background: rgba(201,168,76,0.15); color: var(--gold); }
.source-yelp { background: rgba(210,63,49,0.15); color: #d23f31; }
.source-makemytrip { background: rgba(220,50,50,0.15); color: #dc3232; }
.source-internal { background: rgba(120,120,180,0.15); color: #8888cc; }

/* Platform filter row */
.platform-filter-row {
  display: flex; gap: 8px; flex-wrap: wrap;
  margin-bottom: 20px;
  padding-bottom: 16px;
  border-bottom: 1px solid var(--border);
}
.platform-tab {
  display: inline-flex; align-items: center; gap: 6px;
  padding: 6px 14px;
  border-radius: 20px;
  font-size: 11px; font-weight: 600;
  cursor: none;
  border: 1px solid var(--border);
  color: var(--text-dim);
  background: var(--surface);
  transition: all 0.15s;
  letter-spacing: 0.3px;
}
.platform-tab:hover { border-color: var(--gold); color: var(--text); }
.platform-tab.active {
  color: #0d0a04;
  border-color: transparent;
}
.platform-tab .ptab-count {
  font-size: 10px;
  opacity: 0.75;
  font-weight: 500;
}
.ptab-google.active   { background: #4285f4; }
.ptab-tripadvisor.active { background: #34a853; }
.ptab-makemytrip.active  { background: #dc3232; }
.ptab-bookingcom.active  { background: #0071bb; }
.ptab-agoda.active    { background: #c9a84c; }
.ptab-internal.active { background: #8888cc; }
.ptab-all.active      { background: var(--gold); }

.review-text {
  font-size: 13px;
  line-height: 1.7;
  color: var(--text-dim);
  margin-bottom: 14px;
}

.review-footer {
  display: flex; align-items: center; justify-content: space-between;
}
.sentiment-pill {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: 10px;
  font-weight: 600;
  letter-spacing: 0.5px;
  padding: 3px 10px;
  border-radius: 20px;
}
.pill-positive { background: rgba(78,203,113,0.12); color: var(--positive); border: 1px solid rgba(78,203,113,0.25); }
.pill-negative { background: rgba(232,92,92,0.12); color: var(--negative); border: 1px solid rgba(232,92,92,0.25); }
.pill-neutral { background: rgba(232,201,122,0.12); color: var(--neutral); border: 1px solid rgba(232,201,122,0.25); }

.btn-reply {
  background: none;
  border: 1px solid var(--border);
  border-radius: 6px;
  padding: 5px 14px;
  font-size: 11px;
  color: var(--text-dim);
  cursor: none;
  transition: all 0.15s;
  font-family: 'DM Sans', sans-serif;
}
.btn-reply:hover { border-color: var(--gold); color: var(--gold); }

/* Category insight summary */
.category-insight {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 12px;
  margin-bottom: 28px;
}
.insight-box {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  padding: 16px;
  text-align: center;
}
.insight-val {
  font-family: 'Cormorant Garamond', serif;
  font-size: 28px;
  font-weight: 600;
}
.insight-val.pos { color: var(--positive); }
.insight-val.neg { color: var(--negative); }
.insight-val.neu { color: var(--neutral); }
.insight-label { font-size: 10px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); margin-top: 4px; }

/* Empty state */
.empty-state {
  text-align: center; padding: 60px 20px;
  color: var(--text-muted);
}
.empty-state-icon { font-size: 40px; margin-bottom: 12px; }
.empty-state-text { font-size: 13px; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   REPLY MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.7);
  backdrop-filter: blur(4px);
  display: flex; align-items: center; justify-content: center;
  z-index: 200;
  opacity: 0; pointer-events: none;
  transition: opacity 0.2s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border-strong);
  border-radius: 16px;
  padding: 32px;
  width: 520px;
  max-width: 95vw;
  max-height: 90vh;
  overflow-y: auto;
  transform: scale(0.95);
  transition: transform 0.2s;
}
.modal-overlay.open .modal { transform: scale(1); }
.modal-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 22px;
  font-weight: 600;
  margin-bottom: 20px;
  display: flex; align-items: center; justify-content: space-between;
}
.modal-close {
  background: none; border: none;
  font-size: 20px; color: var(--text-muted);
  cursor: none; transition: color 0.15s;
}
.modal-close:hover { color: var(--negative); }

.template-grid { display: flex; flex-direction: column; gap: 8px; margin-bottom: 16px; }
.template-btn {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 14px;
  font-size: 12px;
  color: var(--text-dim);
  cursor: none;
  text-align: left;
  transition: all 0.15s;
  font-family: 'DM Sans', sans-serif;
}
.template-btn:hover, .template-btn.selected {
  border-color: var(--gold);
  color: var(--text);
  background: var(--gold-dim);
}
.reply-textarea {
  width: 100%;
  height: 100px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 12px 14px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  resize: none;
  outline: none;
  margin-bottom: 16px;
  transition: border-color 0.2s;
  cursor: none;
}
.reply-textarea:focus { border-color: var(--gold); }
.modal-actions { display: flex; gap: 10px; justify-content: flex-end; }
.btn-secondary {
  padding: 10px 20px;
  background: none;
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text-dim);
  font-size: 12px;
  cursor: none;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.15s;
}
.btn-secondary:hover { border-color: var(--text-dim); color: var(--text); }
.btn-primary {
  padding: 10px 24px;
  background: linear-gradient(135deg, #c9a84c, #a8833a);
  border: none;
  border-radius: 8px;
  color: #0d0a04;
  font-size: 12px;
  font-weight: 600;
  cursor: none;
  font-family: 'DM Sans', sans-serif;
  transition: all 0.15s;
}
.btn-primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(201,168,76,0.35); }

/* Toast */
.toast {
  position: fixed; bottom: 28px; right: 28px;
  background: var(--positive);
  color: #0a1a0a;
  padding: 12px 20px;
  border-radius: 10px;
  font-size: 12px;
  font-weight: 600;
  z-index: 300;
  opacity: 0;
  transform: translateY(10px);
  transition: all 0.3s;
  pointer-events: none;
}
.toast.show { opacity: 1; transform: translateY(0); }

/* Scroll */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border-strong); border-radius: 4px; }

/* Re-usable form select (QR page) */
.form-select {
  width: 100%;
  padding: 12px 14px;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  color: var(--text);
  font-family: 'DM Sans', sans-serif;
  font-size: 13px;
  outline: none;
  appearance: none;
  -webkit-appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='10' height='6' viewBox='0 0 10 6'%3E%3Cpath d='M1 1l4 4 4-4' stroke='%23c9a84c' stroke-width='1.5' fill='none' stroke-linecap='round'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  cursor: pointer;
  transition: border-color 0.2s;
}
.form-select:focus { border-color: var(--gold); }

/* Dashboard stats */
.dash-stats {
  display: grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 16px;
  margin-bottom: 28px;
}
.dash-stat {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 20px;
  transition: border-color 0.2s;
}
.dash-stat:hover { border-color: var(--gold); }
.ds-label { font-size: 10px; letter-spacing: 1.5px; text-transform: uppercase; color: var(--text-muted); margin-bottom: 8px; }
.ds-val {
  font-family: 'Cormorant Garamond', serif;
  font-size: 34px;
  font-weight: 600;
  color: var(--text);
}
.ds-sub { font-size: 11px; color: var(--text-muted); margin-top: 4px; }
.ds-val.gold { color: var(--gold); }
.ds-val.green { color: var(--positive); }
.ds-val.red { color: var(--negative); }

/* Source pills row */
.source-stats {
  display: flex; gap: 10px; flex-wrap: wrap;
  margin-bottom: 20px;
}
.source-stat-pill {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 8px 14px;
  font-size: 11px;
  display: flex; align-items: center; gap: 8px;
}
.source-stat-name { color: var(--text-dim); }
.source-stat-count { color: var(--text); font-weight: 600; }

/* Responsive fixes */
@media (max-width: 768px) {
  .sidebar { width: 60px; }
  .sidebar-brand-name, .nav-item span:not(.nav-icon), .nav-badge, .sidebar-footer { display: none; }
  .main-content, .hotel-hero, .detail-content { margin-left: 60px; }
  .hotels-grid { grid-template-columns: 1fr; }
  .dash-stats { grid-template-columns: repeat(2,1fr); }
  .category-tabs .cat-tab { padding: 10px 14px; font-size: 11px; }
}

/* Dashboard-only views */
.panel-section {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 24px;
  margin-bottom: 20px;
}
.panel-section-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 17px;
  font-weight: 600;
  margin-bottom: 18px;
  color: var(--text);
  display: flex; align-items: center; gap: 8px;
}

/* Animated entry for hotel cards */
.hotel-card:nth-child(1) { animation-delay: 0.0s; }
.hotel-card:nth-child(2) { animation-delay: 0.05s; }
.hotel-card:nth-child(3) { animation-delay: 0.1s; }
.hotel-card:nth-child(4) { animation-delay: 0.15s; }
.hotel-card:nth-child(5) { animation-delay: 0.2s; }
.hotel-card:nth-child(6) { animation-delay: 0.25s; }

/* Trending indicator */
.trend-up { color: var(--positive); font-size: 10px; }
.trend-down { color: var(--negative); font-size: 10px; }

/* â”€â”€ WhatsApp Alert Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
.alert-modal-overlay {
  position: fixed; inset: 0;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(6px);
  z-index: 1000;
  display: flex; align-items: center; justify-content: center;
  opacity: 0; pointer-events: none;
  transition: opacity 0.25s;
}
.alert-modal-overlay.open { opacity: 1; pointer-events: all; }
.alert-modal {
  background: var(--surface);
  border: 1px solid rgba(37,211,102,0.35);
  border-radius: 20px;
  padding: 0;
  width: 480px;
  max-width: 95vw;
  box-shadow: 0 30px 80px rgba(0,0,0,0.6), 0 0 0 1px rgba(37,211,102,0.15);
  animation: fadeUp 0.3s ease both;
  overflow: hidden;
}
.alert-modal-header {
  background: linear-gradient(135deg, rgba(37,211,102,0.12), rgba(37,211,102,0.06));
  border-bottom: 1px solid rgba(37,211,102,0.2);
  padding: 20px 24px;
  display: flex; align-items: center; justify-content: space-between;
}
.alert-modal-title {
  font-family: 'Cormorant Garamond', serif;
  font-size: 19px; font-weight: 600;
  color: var(--text);
  display: flex; align-items: center; gap: 10px;
}
.alert-modal-body { padding: 22px 24px; }
.alert-preview-box {
  background: var(--bg3);
  border: 1px solid rgba(37,211,102,0.18);
  border-radius: 10px;
  padding: 14px 16px;
  margin-bottom: 18px;
  font-size: 11px;
  color: var(--text-dim);
  line-height: 1.7;
  max-height: 130px;
  overflow-y: auto;
}
.alert-preview-box strong { color: var(--text); font-size: 12px; }
.alert-input-row { margin-bottom: 16px; }
.alert-input-label {
  font-size: 10px; letter-spacing: 2px; text-transform: uppercase;
  color: var(--text-muted); margin-bottom: 8px; display: block;
}
.alert-channels {
  display: flex; gap: 8px; margin-bottom: 16px;
}
.alert-channel-chip {
  display: flex; align-items: center; gap: 6px;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 11px; font-weight: 600;
  border: 1px solid;
  transition: all 0.15s;
  cursor: none;
}
.chip-wa { border-color: rgba(37,211,102,0.4); color: #25d366; background: rgba(37,211,102,0.08); }
.chip-sms { border-color: rgba(100,149,237,0.4); color: #6495ED; background: rgba(100,149,237,0.08); }
.chip-wa.active { background: rgba(37,211,102,0.18); border-color: #25d366; }
.chip-sms.active { background: rgba(100,149,237,0.18); border-color: #6495ED; }
.alert-modal-footer {
  padding: 16px 24px;
  border-top: 1px solid var(--border);
  display: flex; gap: 10px; justify-content: flex-end;
}
.btn-send-alert {
  background: linear-gradient(135deg, #25d366, #128c7e);
  border: none; border-radius: 8px;
  padding: 11px 24px;
  font-family: 'DM Sans', sans-serif;
  font-size: 13px; font-weight: 600;
  color: #fff; cursor: none;
  transition: all 0.2s;
  display: flex; align-items: center; gap: 8px;
}
.btn-send-alert:hover { transform: translateY(-1px); box-shadow: 0 8px 24px rgba(37,211,102,0.35); }
.btn-send-alert:disabled { opacity: 0.5; transform: none; cursor: not-allowed; }
.alert-sent-badge {
  display: inline-flex; align-items: center; gap: 6px;
  font-size: 10px; font-weight: 600; color: #25d366;
  background: rgba(37,211,102,0.1);
  border: 1px solid rgba(37,211,102,0.3);
  border-radius: 20px; padding: 3px 10px;
}

</style>
</head>
<body>
<!-- Cursor -->
<div id="cursor-ring"></div>
<div id="cursor-dot"></div>

<!-- Particle canvas (dark mode) -->
<canvas id="particle-canvas"></canvas>

<!-- Theme Toggle -->
<div class="theme-toggle" onclick="toggleTheme()" id="themeToggle">
  <span class="theme-toggle-icon" id="themeIcon">â˜€ï¸</span>
  <span id="themeLabel">Light Mode</span>
</div>

<!-- Toast -->
<div class="toast" id="toast"></div>

<!-- Reply Modal -->
<div class="modal-overlay" id="replyModal">
  <div class="modal">
    <div class="modal-title">
      Compose Reply
      <button class="modal-close" onclick="closeModal('replyModal')">âœ•</button>
    </div>
    <div style="font-size:11px;color:var(--text-muted);margin-bottom:16px;letter-spacing:1px;text-transform:uppercase">Quick Templates</div>
    <div class="template-grid">
      <button class="template-btn" onclick="selectTemplate(this, 'Thank you for your wonderful feedback! We are delighted to hear you enjoyed your stay at our property. We look forward to welcoming you back soon.')">ğŸ˜Š Positive â€” Thank You</button>
      <button class="template-btn" onclick="selectTemplate(this, 'We sincerely apologize for the inconvenience you experienced. This does not reflect our standards. Our management team will investigate this personally and ensure corrective action is taken immediately.')">ğŸš¨ Negative â€” Apology</button>
      <button class="template-btn" onclick="selectTemplate(this, 'Thank you for your review. We appreciate you taking the time to share your experience. We are always looking to improve and will take your feedback to heart.')">ğŸ“ Neutral â€” Acknowledge</button>
      <button class="template-btn" onclick="selectTemplate(this, 'We are grateful for your detailed review. Please reach out to our concierge team directly at guestservices@marriott.com so we may personally address your concerns.')">ğŸ“§ Escalate to Team</button>
    </div>
    <textarea class="reply-textarea" id="replyText" placeholder="Write your response here..."></textarea>
    <div class="modal-actions">
      <button class="btn-secondary" onclick="closeModal('replyModal')">Cancel</button>
      <button class="btn-primary" onclick="sendReply()">Send Reply â†’</button>
    </div>
  </div>
</div>


<!-- WhatsApp / SMS Alert Modal -->
<div class="alert-modal-overlay" id="alertModal">
  <div class="alert-modal" style="width:520px">
    <div class="alert-modal-header">
      <div class="alert-modal-title">
        <span style="font-size:22px">ğŸ“±</span> Send Guest Alert
      </div>
      <button class="modal-close" onclick="closeModal('alertModal')" style="cursor:none">âœ•</button>
    </div>
    <div class="alert-modal-body">

      <!-- Guest info row -->
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:16px;padding:12px 14px;background:var(--bg3);border-radius:10px;border:1px solid var(--border)">
        <div>
          <div style="font-size:11px;color:var(--text-muted);margin-bottom:2px">Sending alert for</div>
          <div style="font-size:13px;font-weight:600;color:var(--text)" id="alertGuestName">â€”</div>
          <div style="font-size:11px;color:var(--text-muted)" id="alertHotelName">â€”</div>
        </div>
        <div style="text-align:right">
          <div id="alertStarsDisplay" style="color:var(--negative);font-size:15px;margin-bottom:2px"></div>
          <div style="font-size:10px;color:var(--text-muted)" id="alertRatingLabel"></div>
        </div>
      </div>

      <!-- Channel chips -->
      <div class="alert-channels" style="margin-bottom:14px">
        <div class="alert-channel-chip chip-wa active"><span>ğŸ’¬</span> WhatsApp</div>
        <div class="alert-channel-chip chip-wa active" style="border-color:rgba(37,211,102,0.5);color:#25d366;background:rgba(37,211,102,0.1)"><span>ğŸŸ¢</span> Free Â· No SMS cost</div>
        <div style="margin-left:auto;font-size:10px;color:var(--text-muted);display:flex;align-items:center;gap:4px" title="Meta WhatsApp Business Cloud API">
          <span id="waStatusDot" style="width:7px;height:7px;border-radius:50%;background:#e8c97a;display:inline-block"></span>
          <span id="waStatusLabel" style="color:var(--text-muted)">Checking...</span>
        </div>
      </div>

      <!-- Guest phone -->
      <div class="alert-input-row" style="margin-bottom:12px">
        <label class="alert-input-label">Guest Phone Number</label>
        <input class="form-input" id="alertPhoneInput" type="tel"
          placeholder="+91 98765 43210  or  9876543210"
          style="font-size:14px;letter-spacing:0.5px"
          oninput="validateAlertPhone()">
        <div style="font-size:10px;color:var(--text-muted);margin-top:5px" id="alertPhoneHint">
          Indian 10-digit numbers get +91 added automatically
        </div>
      </div>

      <!-- WhatsApp Business API credentials panel (shown when server is offline) -->
      <div id="waCredsPanel" style="display:none;margin-bottom:14px;border:1px solid rgba(37,211,102,0.25);border-radius:10px;overflow:hidden">
        <div style="background:rgba(37,211,102,0.08);padding:9px 14px;font-size:10px;font-weight:700;letter-spacing:1.5px;text-transform:uppercase;color:#25d366;display:flex;align-items:center;gap:6px;cursor:none" onclick="toggleCredsPanel()">
          <span>ğŸ”‘</span> WhatsApp API Credentials <span style="margin-left:auto;font-size:12px" id="credsPanelArrow">â–¼</span>
        </div>
        <div id="credsPanelBody" style="padding:12px 14px;background:var(--bg3)">
          <div style="font-size:10px;color:var(--text-muted);margin-bottom:10px;line-height:1.6">
            Server is offline. Enter your <strong style="color:#25d366">WhatsApp Business API</strong> credentials to send directly from the browser.<br>
            Get them free at <strong style="color:var(--gold)">developers.facebook.com/apps</strong> â†’ WhatsApp â†’ API Setup.
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:8px">
            <div>
              <div style="font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-muted);margin-bottom:4px">Access Token (WA_TOKEN)</div>
              <input class="form-input" id="credWaToken" type="password" placeholder="EAAxxxxxxxxxxxxxxxx" style="font-size:11px;padding:8px 10px" oninput="saveCreds()">
            </div>
            <div>
              <div style="font-size:9px;letter-spacing:1.5px;text-transform:uppercase;color:var(--text-muted);margin-bottom:4px">Phone Number ID (WA_PHONE_ID)</div>
              <input class="form-input" id="credPhoneId" type="text" placeholder="123456789012345" style="font-size:11px;padding:8px 10px" oninput="saveCreds()">
            </div>
          </div>
          <div style="margin-top:8px;font-size:9px;color:var(--text-muted)">
            ğŸ’¾ Saved in browser localStorage â€” only sent to graph.facebook.com.
          </div>
        </div>
      </div>

      <!-- Message preview -->
      <div class="alert-preview-box" id="alertMessagePreview">
        <strong>Message preview:</strong><br><br>
        <span id="alertMsgText" style="white-space:pre-line">Loading...</span>
      </div>

      <div id="alertStatusMsg" style="display:none;font-size:12px;padding:10px 14px;border-radius:8px;margin-top:8px;line-height:1.6"></div>
    </div>
    <div class="alert-modal-footer">
      <button class="btn-secondary" onclick="closeModal('alertModal')">Cancel</button>
      <button class="btn-send-alert" id="btnSendAlert" onclick="confirmSendAlert()">
        <span>ğŸ“±</span> <span id="btnSendLabel">Send WhatsApp</span>
      </button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 1: LOGIN â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen active" id="screen-login">
  <div class="login-bg-grid"></div>
  <div class="login-card" style="width:460px">
    <div class="login-logo">
      <div class="login-logo-m">M</div>
      <div class="login-logo-brand">Marriott International</div>
      <div class="login-divider"></div>
      <div class="login-logo-sub">Review Intelligence Platform</div>
    </div>

    <!-- Server status badge -->
    <div id="serverBadge" style="text-align:center;font-size:10px;letter-spacing:1px;padding:6px 12px;border-radius:6px;border:1px solid rgba(232,201,122,0.3);color:var(--neutral);margin-bottom:18px;transition:all 0.3s">
      ğŸŸ¡ Checking server...
    </div>

    <!-- Tab toggle -->
    <div style="display:flex;gap:0;margin-bottom:24px;background:var(--bg3);border-radius:8px;padding:3px">
      <button id="tabSignIn" onclick="switchAuthTab('signin')"
        style="flex:1;padding:8px;border:none;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:1px;text-transform:uppercase;cursor:none;transition:all 0.2s;background:var(--gold);color:#0d0a04">Sign In</button>
      <button id="tabSignUp" onclick="switchAuthTab('signup')"
        style="flex:1;padding:8px;border:none;border-radius:6px;font-family:'DM Sans',sans-serif;font-size:12px;font-weight:600;letter-spacing:1px;text-transform:uppercase;cursor:none;transition:all 0.2s;background:transparent;color:var(--text-muted)">Sign Up</button>
    </div>

    <div class="login-error" id="loginError"></div>
    <div id="loginSuccess" style="background:rgba(78,203,113,0.1);border:1px solid rgba(78,203,113,0.3);border-radius:8px;padding:10px 14px;font-size:12px;color:var(--positive);margin-bottom:16px;display:none"></div>

    <!-- SIGN IN FORM -->
    <div id="formSignIn">
      <div class="form-group">
        <label class="form-label">Username or Email</label>
        <input class="form-input" id="username" type="text" placeholder="Enter username or email" autocomplete="username">
      </div>
      <div class="form-group">
        <label class="form-label">Password</label>
        <input class="form-input" id="password" type="password" placeholder="Enter password" autocomplete="current-password">
      </div>
      <button class="btn-login" onclick="handleLogin()">Sign In &#8594;</button>
    </div>

    <!-- SIGN UP FORM -->
    <div id="formSignUp" style="display:none">
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label class="form-label">Full Name</label>
          <input class="form-input" id="reg_name" type="text" placeholder="Your full name">
        </div>
        <div class="form-group">
          <label class="form-label">Username</label>
          <input class="form-input" id="reg_username" type="text" placeholder="Choose username">
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Email</label>
        <input class="form-input" id="reg_email" type="email" placeholder="you@example.com">
      </div>
      <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
        <div class="form-group">
          <label class="form-label">Password</label>
          <input class="form-input" id="reg_password" type="password" placeholder="Min 6 characters">
        </div>
        <div class="form-group">
          <label class="form-label">Role</label>
          <select class="form-input" id="reg_role" style="cursor:none;background:var(--bg3)">
            <option value="Analyst">Analyst</option>
            <option value="Manager">Manager</option>
            <option value="Admin">Admin</option>
          </select>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Phone (optional)</label>
        <input class="form-input" id="reg_phone" type="tel" placeholder="+91 98765 43210">
      </div>
      <button class="btn-login" onclick="handleRegister()">Create Account &#8594;</button>
    </div>
  </div>
</div>

<!-- â•â• SCREEN 2: SEARCH â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-search" style="flex-direction:row">
  <!-- Sidebar (reused across screens 2&3) -->
  <nav class="sidebar" id="sidebar">
    <div class="sidebar-brand">
      <div class="sidebar-brand-m">M</div>
      <div class="sidebar-brand-name">Marriott Reviews</div>
    </div>
    <div class="sidebar-nav">
      <div class="nav-section-label">Main</div>
      <div class="nav-item" onclick="navTo('dashboard')" id="nav-dashboard"><span class="nav-icon">ğŸ“Š</span> Dashboard</div>
      <div class="nav-item active" onclick="navTo('search')" id="nav-search"><span class="nav-icon">ğŸ”</span> Hotel Search</div>
      <div class="nav-section-label">Management</div>
      <div class="nav-item" onclick="navTo('queue')" id="nav-queue"><span class="nav-icon">ğŸ’¬</span> Response Queue <span class="nav-badge">7</span></div>
      <div class="nav-item" onclick="navTo('analytics')" id="nav-analytics"><span class="nav-icon">ğŸ“ˆ</span> Analytics</div>
      <div class="nav-item" onclick="navTo('alerts')" id="nav-alerts"><span class="nav-icon">ğŸš¨</span> Alerts</div>
      <div class="nav-item" onclick="navTo('spam')" id="nav-spam"><span class="nav-icon">ğŸš«</span> Spam Reports</div>
      <div class="nav-item" onclick="navTo('qrcollect')" id="nav-qrcollect"><span class="nav-icon">ğŸ“±</span> QR Collector</div>
    </div>
    <div class="sidebar-footer">
      <div class="sidebar-user">
        <div class="sidebar-avatar" id="sidebarAvatar">JM</div>
        <div class="sidebar-user-info">
          <div class="sidebar-user-name" id="sidebarName">John Mitchell</div>
          <div class="sidebar-user-role" id="sidebarRole">Admin</div>
        </div>
      </div>
      <button class="btn-logout" onclick="handleLogout()">Logout</button>
    </div>
  </nav>

  <div class="main-content" style="width:100%">
    <div class="topbar">
      <div>
        <div class="topbar-title" id="topbarTitle">Hotel Search</div>
        <div class="topbar-subtitle" id="topbarSubtitle">Find and analyze reviews across all Marriott properties</div>
      </div>
      <div class="topbar-actions">
        <span style="font-size:11px;color:var(--text-muted)">Marriott International Â· All Properties</span>
      </div>
    </div>

    <div class="page-content" id="pageContent">
      <!-- Content switches here based on nav -->
    </div>
  </div>
</div>

<!-- â•â• SCREEN 3: HOTEL DETAIL â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div class="screen" id="screen-detail" style="flex-direction:column">
  <!-- Hero -->
  <div class="hotel-hero" id="hotelHero">
    <span class="hotel-hero-back" onclick="goBack()">â† Back to Search</span>
    <div class="hotel-hero-top">
      <div class="hotel-hero-icon" id="hotelHeroIcon">ğŸ¨</div>
      <div class="hotel-hero-info">
        <div class="hotel-hero-name" id="hotelHeroName">Loading...</div>
        <div class="hotel-hero-location" id="hotelHeroLocation">ğŸ“</div>
        <div id="hotelHeroStars"></div>
      </div>
      <div style="text-align:right">
        <div class="hotel-hero-rating">
          <span id="hotelHeroRating">-.-</span>
          <span class="hotel-hero-rating-sub">/ 5</span>
        </div>
        <div style="font-size:11px;color:var(--text-muted)" id="hotelHeroCount">â€” reviews</div>
      </div>
    </div>
    <div class="hotel-hero-stats" id="hotelHeroStats"></div>
    <div class="category-tabs" id="categoryTabs">
      <div class="cat-tab active" onclick="switchCategory('all')" data-cat="all">
        <span>ğŸ“‹</span> All Reviews <span class="cat-tab-count" id="cnt-all">0</span>
      </div>
      <div class="cat-tab" onclick="switchCategory('food')" data-cat="food">
        <span>ğŸ½ï¸</span> Food <span class="cat-tab-count" id="cnt-food">0</span>
      </div>
      <div class="cat-tab" onclick="switchCategory('ambiance')" data-cat="ambiance">
        <span>âœ¨</span> Ambiance <span class="cat-tab-count" id="cnt-ambiance">0</span>
      </div>
      <div class="cat-tab" onclick="switchCategory('amenities')" data-cat="amenities">
        <span>ğŸŠ</span> Amenities <span class="cat-tab-count" id="cnt-amenities">0</span>
      </div>
      <div class="cat-tab" onclick="switchCategory('service')" data-cat="service">
        <span>ğŸ¤</span> Service <span class="cat-tab-count" id="cnt-service">0</span>
      </div>
    </div>
  </div>

  <div class="detail-content" id="detailContent">
    <div class="loading"><div class="spinner"></div> Loading reviews...</div>
  </div>
</div>

<!-- â•â• SIDEBAR (cloned into detail screen via JS) â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CUSTOM CURSOR
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const cursorRing = document.getElementById('cursor-ring');
const cursorDot = document.getElementById('cursor-dot');
let mx = 0, my = 0, rx = 0, ry = 0;

document.addEventListener('mousemove', e => {
  mx = e.clientX; my = e.clientY;
  cursorDot.style.left = mx + 'px';
  cursorDot.style.top = my + 'px';
});

function animateCursor() {
  rx += (mx - rx) * 0.12;
  ry += (my - ry) * 0.12;
  cursorRing.style.left = rx + 'px';
  cursorRing.style.top = ry + 'px';
  requestAnimationFrame(animateCursor);
}
animateCursor();

document.addEventListener('mouseover', e => {
  if (e.target.matches('button, a, input, select, [onclick], .nav-item, .hotel-card, .cat-tab, .sent-tab, .filter-chip, .review-card')) {
    cursorRing.classList.add('hover');
  } else {
    cursorRing.classList.remove('hover');
  }
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PARTICLES (dark mode)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const canvas = document.getElementById('particle-canvas');
const ctx = canvas.getContext('2d');
let particles = [];
let W, H;

function resizeCanvas() {
  W = canvas.width = window.innerWidth;
  H = canvas.height = window.innerHeight;
}
resizeCanvas();
window.addEventListener('resize', resizeCanvas);

function spawnParticle() {
  return {
    x: Math.random() * W, y: Math.random() * H,
    vx: (Math.random() - 0.5) * 0.3,
    vy: (Math.random() - 0.5) * 0.3,
    r: Math.random() * 1.5 + 0.5,
    a: Math.random() * 0.4 + 0.1,
    mx: 0, my: 0,
  };
}

for (let i = 0; i < 80; i++) particles.push(spawnParticle());

let mouseX = W/2, mouseY = H/2;
document.addEventListener('mousemove', e => { mouseX = e.clientX; mouseY = e.clientY; });

function drawParticles() {
  ctx.clearRect(0, 0, W, H);
  if (document.documentElement.getAttribute('data-theme') !== 'dark') {
    requestAnimationFrame(drawParticles); return;
  }

  particles.forEach(p => {
    // Anti-gravity: repel from cursor
    const dx = mouseX - p.x, dy = mouseY - p.y;
    const dist = Math.sqrt(dx*dx + dy*dy);
    if (dist < 120) {
      const force = (120 - dist) / 120 * 0.008;
      p.vx -= dx * force;
      p.vy -= dy * force;
    }

    p.vx *= 0.99; p.vy *= 0.99;
    p.x += p.vx; p.y += p.vy;

    if (p.x < 0) p.x = W; if (p.x > W) p.x = 0;
    if (p.y < 0) p.y = H; if (p.y > H) p.y = 0;

    ctx.beginPath();
    ctx.arc(p.x, p.y, p.r, 0, Math.PI*2);
    ctx.fillStyle = `rgba(201, 168, 76, ${p.a})`;
    ctx.fill();
  });

  // Draw subtle connections
  for (let i = 0; i < particles.length; i++) {
    for (let j = i+1; j < particles.length; j++) {
      const dx = particles[i].x - particles[j].x;
      const dy = particles[i].y - particles[j].y;
      const d = Math.sqrt(dx*dx + dy*dy);
      if (d < 100) {
        ctx.beginPath();
        ctx.moveTo(particles[i].x, particles[i].y);
        ctx.lineTo(particles[j].x, particles[j].y);
        ctx.strokeStyle = `rgba(201,168,76,${0.08 * (1 - d/100)})`;
        ctx.lineWidth = 0.5;
        ctx.stroke();
      }
    }
  }

  requestAnimationFrame(drawParticles);
}
drawParticles();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  THEME
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function toggleTheme() {
  const isDark = document.documentElement.getAttribute('data-theme') === 'dark';
  document.documentElement.setAttribute('data-theme', isDark ? 'light' : 'dark');
  document.getElementById('themeIcon').textContent = isDark ? 'ğŸŒ™' : 'â˜€ï¸';
  document.getElementById('themeLabel').textContent = isDark ? 'Dark Mode' : 'Light Mode';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentUser = null;
let currentHotel = null;
let currentReviews = [];
let currentCategory = 'all';
let currentSentiment = 'all';
let currentSource    = 'all';
let currentSourceCounts = {};
const API = 'http://localhost:3001/api';

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SCREEN NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById('screen-' + id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUTH â€” MongoDB when running, localStorage demo when offline
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

let authToken = null;
let serverOnline = false;

// â”€â”€ Demo user store (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getDemoUsers() {
  try { return JSON.parse(localStorage.getItem('marriott_demo_users') || '{}'); } catch { return {}; }
}
function saveDemoUsers(users) {
  localStorage.setItem('marriott_demo_users', JSON.stringify(users));
}
// Seed default demo accounts on first load
(function seedDemoAccounts() {
  const existing = getDemoUsers();
  if (!existing['admin']) {
    const defaults = {
      admin:   { username:'admin',   email:'admin@marriott.com',   name:'Arjun Mehta',  password:'marriott2024', role:'Admin',   phone:'' },
      manager: { username:'manager', email:'manager@marriott.com', name:'Priya Nair',   password:'manager123',   role:'Manager', phone:'' },
      analyst: { username:'analyst', email:'analyst@marriott.com', name:'Rohit Sharma', password:'analyst123',   role:'Analyst', phone:'' },
    };
    saveDemoUsers(defaults);
  }
})();

function showAuthError(msg) {
  const el = document.getElementById('loginError');
  el.textContent = msg; el.classList.add('show');
  document.getElementById('loginSuccess').style.display = 'none';
}
function showAuthSuccess(msg) {
  const el = document.getElementById('loginSuccess');
  el.textContent = msg; el.style.display = 'block';
  document.getElementById('loginError').classList.remove('show');
}
function clearAuthMessages() {
  document.getElementById('loginError').classList.remove('show');
  document.getElementById('loginSuccess').style.display = 'none';
}

function updateServerBadge(online) {
  const badge = document.getElementById('serverBadge');
  if (!badge) return;
  serverOnline = online;
  if (online) {
    badge.innerHTML = 'ğŸŸ¢ MongoDB connected';
    badge.style.color = 'var(--positive)';
    badge.style.borderColor = 'rgba(78,203,113,0.3)';
  } else {
    badge.innerHTML = 'ğŸŸ¡ Demo mode â€” <span style="text-decoration:underline;cursor:pointer" onclick="showServerHelp()">start backend to save data</span>';
    badge.style.color = 'var(--neutral)';
    badge.style.borderColor = 'rgba(232,201,122,0.3)';
  }
}

function showServerHelp() {
  alert('To connect MongoDB backend:\n\n1. cd marriott-backend\n2. npm install\n3. node seed.js\n4. node server.js\n\nServer runs on http://localhost:3001\nAll accounts created in demo mode will be saved locally.');
}

function switchAuthTab(tab) {
  clearAuthMessages();
  const isSignIn = tab === 'signin';
  document.getElementById('formSignIn').style.display = isSignIn ? 'block' : 'none';
  document.getElementById('formSignUp').style.display = isSignIn ? 'none' : 'block';
  document.getElementById('tabSignIn').style.background = isSignIn ? 'var(--gold)' : 'transparent';
  document.getElementById('tabSignIn').style.color = isSignIn ? '#0d0a04' : 'var(--text-muted)';
  document.getElementById('tabSignUp').style.background = isSignIn ? 'transparent' : 'var(--gold)';
  document.getElementById('tabSignUp').style.color = isSignIn ? 'var(--text-muted)' : '#0d0a04';
}

async function handleLogin() {
  const username = document.getElementById('username').value.trim();
  const password = document.getElementById('password').value;
  clearAuthMessages();
  if (!username || !password) { showAuthError('Please enter your username/email and password.'); return; }
  const btn = document.querySelector('#formSignIn .btn-login');
  btn.textContent = 'Signing in...'; btn.disabled = true;

  // â”€â”€ Try MongoDB backend first â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  try {
    const res = await fetch(`${API}/auth/login`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username, password }),
      signal: AbortSignal.timeout(3000),
    });
    const data = await res.json();
    if (!res.ok) {
      showAuthError(data.error || 'Invalid credentials');
      btn.textContent = 'Sign In â†’'; btn.disabled = false;
      return;
    }
    authToken = data.token;
    localStorage.setItem('marriott_token', authToken);
    currentUser = data.user;
    updateServerBadge(true);
    initDashboard(); showSearch();
    btn.textContent = 'Sign In â†’'; btn.disabled = false;
    return;
  } catch (_) { /* server offline â€” fall through to demo mode */ }

  // â”€â”€ Demo mode fallback (localStorage) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const users = getDemoUsers();
  const u = users[username.toLowerCase()] || Object.values(users).find(u => u.email === username.toLowerCase());
  if (u && u.password === password) {
    currentUser = { username: u.username, name: u.name, role: u.role, email: u.email };
    localStorage.setItem('marriott_session', JSON.stringify(currentUser));
    updateServerBadge(false);
    initDashboard(); showSearch();
  } else {
    showAuthError('Invalid credentials. Check username/password or Sign Up to create an account.');
  }
  btn.textContent = 'Sign In â†’'; btn.disabled = false;
}

async function handleRegister() {
  const name     = document.getElementById('reg_name').value.trim();
  const username = document.getElementById('reg_username').value.trim().toLowerCase();
  const email    = document.getElementById('reg_email').value.trim().toLowerCase();
  const password = document.getElementById('reg_password').value;
  const role     = document.getElementById('reg_role').value;
  const phone    = document.getElementById('reg_phone').value.trim();
  clearAuthMessages();
  if (!name || !username || !email || !password) { showAuthError('Name, username, email and password are all required.'); return; }
  if (password.length < 6) { showAuthError('Password must be at least 6 characters.'); return; }
  if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)) { showAuthError('Please enter a valid email address.'); return; }
  const btn = document.querySelector('#formSignUp .btn-login');
  btn.textContent = 'Creating account...'; btn.disabled = true;

  // â”€â”€ Try MongoDB backend first â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  try {
    const res = await fetch(`${API}/auth/register`, {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ name, username, email, password, role, phone }),
      signal: AbortSignal.timeout(3000),
    });
    const data = await res.json();
    if (!res.ok) {
      showAuthError(data.error || 'Registration failed');
      btn.textContent = 'Create Account â†’'; btn.disabled = false;
      return;
    }
    showAuthSuccess('Account created! Signing you in...');
    authToken = data.token;
    localStorage.setItem('marriott_token', authToken);
    currentUser = data.user;
    updateServerBadge(true);
    setTimeout(() => { initDashboard(); showSearch(); }, 700);
    btn.textContent = 'Create Account â†’'; btn.disabled = false;
    return;
  } catch (_) { /* server offline â€” save locally */ }

  // â”€â”€ Demo mode fallback â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  const users = getDemoUsers();
  if (users[username]) { showAuthError('Username already taken. Choose a different one.'); btn.textContent = 'Create Account â†’'; btn.disabled = false; return; }
  if (Object.values(users).find(u => u.email === email)) { showAuthError('Email already registered.'); btn.textContent = 'Create Account â†’'; btn.disabled = false; return; }
  users[username] = { username, email, name, password, role, phone };
  saveDemoUsers(users);
  currentUser = { username, name, role, email };
  localStorage.setItem('marriott_session', JSON.stringify(currentUser));
  showAuthSuccess('Account created locally! (Start backend to sync to MongoDB)');
  updateServerBadge(false);
  setTimeout(() => { initDashboard(); showSearch(); }, 700);
  btn.textContent = 'Create Account â†’'; btn.disabled = false;
}

// Enter key support
document.getElementById('password').addEventListener('keydown', e => { if (e.key === 'Enter') handleLogin(); });
document.getElementById('username').addEventListener('keydown', e => { if (e.key === 'Enter') document.getElementById('password').focus(); });

// Auto-restore session on page load
window.addEventListener('load', async () => {
  // Try JWT session (MongoDB)
  const savedToken = localStorage.getItem('marriott_token');
  if (savedToken) {
    try {
      const res = await fetch(`${API}/auth/me`, {
        headers: { Authorization: 'Bearer ' + savedToken },
        signal: AbortSignal.timeout(2000),
      });
      if (res.ok) {
        authToken = savedToken;
        currentUser = await res.json();
        updateServerBadge(true);
        initDashboard(); showSearch();
        return;
      }
    } catch (_) {}
    localStorage.removeItem('marriott_token');
  }
  // Try demo session (localStorage)
  const demoSession = localStorage.getItem('marriott_session');
  if (demoSession) {
    try {
      currentUser = JSON.parse(demoSession);
      updateServerBadge(false);
      initDashboard(); showSearch();
      return;
    } catch (_) {}
  }
  // Check server status for the badge
  fetch(`${API}/hotels/search?q=`, { signal: AbortSignal.timeout(2000) })
    .then(() => updateServerBadge(true))
    .catch(() => updateServerBadge(false));
});

function handleLogout() {
  currentUser = null;
  authToken = null;
  localStorage.removeItem('marriott_token');
  localStorage.removeItem('marriott_session');
  showScreen('login');
  document.getElementById('username').value = '';
  document.getElementById('password').value = '';
  switchAuthTab('signin');
  // Recheck server on logout
  fetch(`${API}/hotels/search?q=`, { signal: AbortSignal.timeout(2000) })
    .then(() => updateServerBadge(true))
    .catch(() => updateServerBadge(false));
}

function initDashboard() {
  const initials = currentUser.name.split(' ').map(n=>n[0]).join('').substring(0,2).toUpperCase();
  document.getElementById('sidebarAvatar').textContent = initials;
  document.getElementById('sidebarName').textContent = currentUser.name;
  document.getElementById('sidebarRole').textContent = currentUser.role;
}

// Authenticated fetch helper â€” uses JWT when online, skips auth when demo
async function apiFetch(url, options = {}) {
  return fetch(url, {
    ...options,
    headers: {
      'Content-Type': 'application/json',
      ...(options.headers || {}),
      ...(authToken ? { Authorization: 'Bearer ' + authToken } : {}),
    },
  });
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showSearch() {
  showScreen('search');
  navTo('search');
}

function navTo(section) {
  document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
  const el = document.getElementById('nav-' + section);
  if (el) el.classList.add('active');

  const titleMap = {
    dashboard: ['Dashboard', 'Overview of all Marriott properties'],
    search: ['Hotel Search', 'Find and analyze reviews across all properties'],
    queue: ['Response Queue', 'Reviews awaiting your response'],
    analytics: ['Analytics', 'Sentiment trends and performance insights'],
    alerts: ['Alerts', 'Critical reviews requiring immediate attention'],
    spam: ['Spam Reports', 'Detected and reported spam reviews'],
    qrcollect: ['QR Collector', 'Generate QR codes and manage internal review submissions'],
  };
  const [title, sub] = titleMap[section] || ['Overview', ''];
  document.getElementById('topbarTitle').textContent = title;
  document.getElementById('topbarSubtitle').textContent = sub;

  const pc = document.getElementById('pageContent');
  if (section === 'search') renderSearchPage(pc);
  else if (section === 'dashboard') renderDashboardPage(pc);
  else if (section === 'queue') renderQueuePage(pc);
  else if (section === 'analytics') renderAnalyticsPage(pc);
  else if (section === 'alerts') renderAlertsPage(pc);
  else if (section === 'spam') renderSpamPage(pc);
  else if (section === 'qrcollect') renderQRPage(pc);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SEARCH PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderSearchPage(container) {
  container.innerHTML = `
    <div class="search-wrap">
      <div class="search-label">Find a Hotel</div>
      <div class="search-sublabel">SEARCH BY NAME OR LOCATION</div>
      <div class="search-box">
        <span class="search-icon">ğŸ”</span>
        <input class="search-input" id="hotelSearchInput" type="text" placeholder="e.g. JW Marriott Mumbai or Bengaluru..." oninput="debounceSearch(this.value)">
        <button class="search-clear" onclick="clearSearch()">âœ•</button>
      </div>
    </div>
    <div id="hotelsResult"></div>
  `;
  loadHotels('');
}

let searchTimer;
function debounceSearch(q) {
  clearTimeout(searchTimer);
  searchTimer = setTimeout(() => loadHotels(q), 300);
}

function clearSearch() {
  document.getElementById('hotelSearchInput').value = '';
  loadHotels('');
}

async function loadHotels(q) {
  const el = document.getElementById('hotelsResult');
  if (!el) return;
  el.innerHTML = `<div class="loading"><div class="spinner"></div> Searching properties...</div>`;

  try {
    const res = await fetch(`${API}/hotels/search?q=${encodeURIComponent(q)}`);
    const hotels = await res.json();
    renderHotelCards(el, hotels);
  } catch {
    // Fallback mock data
    const hotels = getMockHotels(q);
    renderHotelCards(el, hotels);
  }
}

function getMockHotels(q) {
  const all = [
    { id:'mh001', name:'W Marriott Juhu', location:'Mumbai, Maharashtra', rating:4.7, reviewCount:3842 },
    { id:'mh002', name:'Marriott Marquis Mumbai', location:'Mumbai, Maharashtra', rating:4.5, reviewCount:2156 },
    { id:'mh003', name:'JW Marriott Bangalore', location:'Bengaluru, Karnataka', rating:4.6, reviewCount:2984 },
    { id:'mh004', name:'Marriott Hotel New Delhi', location:'New Delhi, Delhi', rating:4.4, reviewCount:1923 },
    { id:'mh005', name:'Marriott Pune', location:'Pune, Maharashtra', rating:4.3, reviewCount:1567 },
    { id:'mh006', name:'JW Marriott Kolkata', location:'Kolkata, West Bengal', rating:4.5, reviewCount:2201 },
    { id:'mh007', name:'Marriott Hotel Chandigarh', location:'Chandigarh, Punjab', rating:4.3, reviewCount:987 },
    { id:'mh008', name:'Sheraton Grand Bangalore', location:'Bengaluru, Karnataka', rating:4.4, reviewCount:1876 },
    { id:'mh009', name:'W Mumbai', location:'Mumbai, Maharashtra', rating:4.6, reviewCount:2543 },
    { id:'mh010', name:'Marriott Hyderabad', location:'Hyderabad, Telangana', rating:4.5, reviewCount:1654 },
  ];
  if (!q) return all;
  const lq = q.toLowerCase();
  return all.filter(h => h.name.toLowerCase().includes(lq) || h.location.toLowerCase().includes(lq));
}

const hotelImages = [
  'https://dynamic-media-cdn.tripadvisor.com/media/photo-o/06/1e/e3/50/jw-marriott-hotel-mumbai.jpg?w=500&h=400&s=1', // Mumbai Juhu
  'https://dynamic-media-cdn.tripadvisor.com/media/photo-o/01/fb/fa/d5/jw-marriott-hotel-mumbai.jpg?w=900&h=500&s=1', // Mumbai Marquis
  'https://ik.imgkit.net/3vlqs5axxjf/external/https://www.cfmedia.vfmleonardo.com/imageRepo/2/0/189/247/168/jRDwZg6Z30uBChyWJTaPkQ_blrjw-exterior-3296_O.jpg', // Bengaluru
  'https://content.skyscnr.com/available/2309977916/2309977916_WxH.jpg', // Delhi Aerocity
  'https://gos3.ibcdn.com/768cbf82af3611ecad4c0a58a9feac02.jpg', // Pune
  'https://cf.bstatic.com/xdata/images/hotel/max1024x768/519403307.jpg?k=f0b5f969ab27c629a8528b5aab3b757ed2db8a6e15f62b846a6034c31323f355', // Kolkata
  'https://cache.marriott.com/content/dam/marriott-renditions/BLRGS/blrgs-exterior-8001-hor-feat.jpg', // Sheraton Grand BLR
  'https://www.gjgroup.in/images/hotel/W_Hotel_Mumbai_1.jpg', // W Mumbai
  'https://hellohyderabad.org/wp-content/uploads/2024/07/Untitled-design-13.jpg', // Hyderabad
  'https://cache.marriott.com/content/dam/marriott-digital/jw/apec/hws/i/ixcjw/en_us/photo/unlimited/assets/ixcjw-exterior-1612.jpg' // Chandigarh
];

function renderHotelCards(el, hotels) {
  if (!hotels.length) {
    el.innerHTML = `<div class="empty-state">No properties found.</div>`;
    return;
  }
 
  el.innerHTML = `<div class="hotels-grid">${hotels.map((h, i) => {
    // Cycles through your 10 provided photos
    const imgSrc = hotelImages[i % hotelImages.length];
   
    return `
    <div class="hotel-card" onclick="openHotel('${h.id}', ${JSON.stringify(h).replace(/"/g, '&quot;')})">
      <div class="hotel-card-img">
        <img src="${imgSrc}" alt="${h.name}" loading="lazy" style="width:100%; height:100%; object-fit:cover;">
        <div class="hotel-card-source-badge">Marriott</div>
      </div>
      <div class="hotel-card-body">
        <div class="hotel-card-name">${h.name}</div>
        <div class="hotel-card-loc">ğŸ“ ${h.location}</div>
        <div class="hotel-card-stars">${'â˜…'.repeat(Math.floor(h.rating))}${'â˜†'.repeat(5-Math.floor(h.rating))}</div>
        <div class="hotel-card-meta">
          <div>
            <div class="hotel-card-rating">${h.rating}</div>
            <div class="hotel-card-review-count">${h.reviewCount.toLocaleString()} reviews</div>
          </div>
          <div class="hotel-card-cta">View Reviews â†’</div>
        </div>
      </div>
    </div>
  `}).join('')}</div>`;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  HOTEL DETAIL
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function openHotel(id, hotelData) {
  currentHotel = typeof hotelData === 'string' ? JSON.parse(hotelData) : hotelData;
  currentCategory = 'all';
  currentSentiment = 'all';
  currentSource = 'all';
  currentSourceCounts = {};
  currentReviews = [];

  // Inject sidebar into detail screen
  const detailScreen = document.getElementById('screen-detail');
  let sidebarClone = detailScreen.querySelector('.sidebar');
  if (!sidebarClone) {
    sidebarClone = document.getElementById('sidebar').cloneNode(true);
    sidebarClone.id = 'sidebar-detail';
    detailScreen.prepend(sidebarClone);
    // Fix clone nav items
    sidebarClone.querySelectorAll('.nav-item').forEach(ni => {
      ni.onclick = () => { showSearch(); navTo(ni.id?.replace('nav-','') || 'search'); };
    });
    sidebarClone.querySelector('.btn-logout')?.addEventListener('click', handleLogout);
  }

  showScreen('detail');

  // Set hotel info in hero
  document.getElementById('hotelHeroName').textContent = currentHotel.name;
  document.getElementById('hotelHeroLocation').innerHTML = 'ğŸ“ ' + currentHotel.location;
  document.getElementById('hotelHeroStars').innerHTML = `<div class="hotel-hero-stars">${'â˜…'.repeat(Math.floor(currentHotel.rating))}${'â˜†'.repeat(5-Math.floor(currentHotel.rating))}</div>`;
  document.getElementById('hotelHeroRating').textContent = currentHotel.rating;
  document.getElementById('hotelHeroCount').textContent = (currentHotel.reviewCount||0).toLocaleString() + ' reviews';

  document.getElementById('detailContent').innerHTML = `<div class="loading"><div class="spinner"></div> Fetching reviews from all platforms...</div>`;

  try {
    const res = await fetch(`${API}/hotels/${id}/reviews`);
    if (!res.ok) throw new Error('API error');
    const data = await res.json();
    data.reviews = mergeInternalReviews(id, data.reviews);
    currentReviews = data.reviews;
    if (data.sourceCounts) currentSourceCounts = data.sourceCounts;
    renderHotelDetail(data);
  } catch {
    // Use mock
    let reviews = generateMockReviewsFrontend(currentHotel.name, 150);
    reviews = mergeInternalReviews(id, reviews);
    currentReviews = reviews;
    const stats = computeStats(reviews);
    renderHotelDetail({ hotel: currentHotel, reviews, stats });
  }
}

function goBack() {
  showScreen('search');
}

function computeStats(reviews) {
  const byCategory = { food:[], ambiance:[], amenities:[], service:[] };
  reviews.forEach(r => {
    r.categories.forEach(c => { if (byCategory[c]) byCategory[c].push(r); });
  });
  const bySource = {};
  reviews.forEach(r => { bySource[r.source] = (bySource[r.source]||0)+1; });
  return {
    totalReviews: reviews.length,
    avgRating: (reviews.reduce((s,r)=>s+r.rating,0)/reviews.length).toFixed(1),
    sentiment: {
      positive: reviews.filter(r=>r.sentiment==='positive').length,
      neutral: reviews.filter(r=>r.sentiment==='neutral').length,
      negative: reviews.filter(r=>r.sentiment==='negative').length,
    },
    bySource, byCategory
  };
}

function renderHotelDetail(data) {
  const { reviews, stats } = data;
  currentReviews = reviews;

  // Update hero stats
  document.getElementById('hotelHeroRating').textContent = stats.avgRating;
  document.getElementById('hotelHeroStats').innerHTML = `
    <div class="hhs"><div class="hhs-val">${stats.totalReviews}</div><div class="hhs-label">Total Reviews</div></div>
    <div class="hhs"><div class="hhs-val" style="color:var(--positive)">${stats.sentiment.positive}</div><div class="hhs-label">Positive</div></div>
    <div class="hhs"><div class="hhs-val" style="color:var(--negative)">${stats.sentiment.negative}</div><div class="hhs-label">Negative</div></div>
    <div class="hhs"><div class="hhs-val" style="color:var(--neutral)">${stats.sentiment.neutral}</div><div class="hhs-label">Neutral</div></div>
    <div class="hhs"><div class="hhs-val">${Object.keys(stats.bySource).length}</div><div class="hhs-label">Platforms</div></div>
  `;

  // Update tab counts
  document.getElementById('cnt-all').textContent = reviews.length;
  ['food','ambiance','amenities','service'].forEach(cat => {
    const cnt = reviews.filter(r => r.categories.includes(cat)).length;
    document.getElementById('cnt-' + cat).textContent = cnt;
  });

  renderDetailContent();
}

function switchCategory(cat) {
  currentCategory = cat;
  currentSentiment = 'all';
  currentSource = 'all';
  document.querySelectorAll('.cat-tab').forEach(t => {
    t.classList.toggle('active', t.dataset.cat === cat);
  });
  renderDetailContent();
}

function switchSentiment(sent) {
  currentSentiment = sent;
  document.querySelectorAll('.sent-tab').forEach(t => {
    t.className = 'sent-tab';
    if (t.dataset.sent === sent) t.classList.add('active-' + sent);
  });
  renderDetailContent();
}

function switchSource(src) {
  currentSource = src;
  renderDetailContent();
}

function renderDetailContent() {
  // Filter by category
  let filtered = currentCategory === 'all'
    ? [...currentReviews]
    : currentReviews.filter(r => r.categories.includes(currentCategory));

  // Filter by sentiment
  if (currentSentiment !== 'all') {
    filtered = filtered.filter(r => r.sentiment === currentSentiment);
  }

  // Filter by platform/source
  if (currentSource !== 'all') {
    filtered = filtered.filter(r => r.source === currentSource);
  }

  const posCount = filtered.filter(r=>r.sentiment==='positive').length;
  const negCount = filtered.filter(r=>r.sentiment==='negative').length;
  const neuCount = filtered.filter(r=>r.sentiment==='neutral').length;

  // Build source counts from all current-category reviews (before source filter)
  const catFiltered = currentCategory === 'all'
    ? [...currentReviews]
    : currentReviews.filter(r => r.categories.includes(currentCategory));
  const srcCounts = {};
  catFiltered.forEach(r => { srcCounts[r.source] = (srcCounts[r.source]||0)+1; });

  const PLATFORM_META = [
    { key:'all',         label:'All Platforms', icon:'ğŸŒ', cls:'ptab-all' },
    { key:'google',      label:'Google',        icon:'ğŸ”µ', cls:'ptab-google' },
    { key:'tripadvisor', label:'TripAdvisor',   icon:'ğŸŸ¢', cls:'ptab-tripadvisor' },
    { key:'makemytrip',  label:'MakeMyTrip',    icon:'ğŸ”´', cls:'ptab-makemytrip' },
    { key:'booking.com', label:'Booking.com',   icon:'ğŸ”·', cls:'ptab-bookingcom' },
    { key:'agoda',       label:'Agoda',         icon:'ğŸŸ¡', cls:'ptab-agoda' },
    { key:'internal',    label:'Internal (QR)', icon:'ğŸ“‹', cls:'ptab-internal' },
  ];

  const container = document.getElementById('detailContent');
  container.innerHTML = `
    <div class="category-insight">
      <div class="insight-box">
        <div class="insight-val pos">${posCount}</div>
        <div class="insight-label">Positive</div>
      </div>
      <div class="insight-box">
        <div class="insight-val neg">${negCount}</div>
        <div class="insight-label">Negative</div>
      </div>
      <div class="insight-box">
        <div class="insight-val neu">${neuCount}</div>
        <div class="insight-label">Neutral</div>
      </div>
    </div>

    <div class="platform-filter-row">
      ${PLATFORM_META.map(p => {
        const cnt = p.key === 'all' ? catFiltered.length : (srcCounts[p.key] || 0);
        if (p.key !== 'all' && cnt === 0) return '';
        const isActive = currentSource === p.key;
        return `<button class="platform-tab ${p.cls} ${isActive ? 'active' : ''}" onclick="switchSource('${p.key}')">
          ${p.icon} ${p.label} <span class="ptab-count">(${cnt})</span>
        </button>`;
      }).join('')}
    </div>

    <div class="sentiment-tabs">
      <div class="sent-tab active-all" data-sent="all" onclick="switchSentiment('all')">
        <span class="sent-indicator all"></span> All (${filtered.length})
      </div>
      <div class="sent-tab" data-sent="positive" onclick="switchSentiment('positive')">
        <span class="sent-indicator positive"></span> Positive (${posCount})
      </div>
      <div class="sent-tab" data-sent="negative" onclick="switchSentiment('negative')">
        <span class="sent-indicator negative"></span> Negative (${negCount})
      </div>
      <div class="sent-tab" data-sent="neutral" onclick="switchSentiment('neutral')">
        <span class="sent-indicator neutral"></span> Neutral (${neuCount})
      </div>
    </div>
    <div class="reviews-container" id="reviewsContainer">
      ${filtered.length === 0
        ? `<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><div class="empty-state-text">No reviews for this filter combination.</div></div>`
        : filtered.map(r => renderReviewCard(r)).join('')}
    </div>
  `;
}

function renderReviewCard(r) {
  const initials = (r.author || 'A').split(' ').map(w=>w[0]).join('').substring(0,2).toUpperCase();
  const avatarColors = ['#4caf7d22', '#5b8dee22', '#e8b84b22', '#c97be022', '#e05c5c22'];
  const textColors   = ['#4caf7d',   '#5b8dee',   '#e8b84b',   '#c97be0',   '#e05c5c'];
  const ci = initials.charCodeAt(0) % 5;
  const stars = 'â˜…'.repeat(Math.floor(r.rating||3)) + 'â˜†'.repeat(5-Math.floor(r.rating||3));
  const sentClass = r.sentiment === 'positive' ? 'pill-positive' : r.sentiment === 'negative' ? 'pill-negative' : 'pill-neutral';
  const sentEmoji = r.sentiment === 'positive' ? 'ğŸ˜Š' : r.sentiment === 'negative' ? 'ğŸ˜ ' : 'ğŸ˜';
  const srcKey = (r.source||'internal').toLowerCase().replace(/[^a-z]/g, '');
  const srcClass = 'source-' + srcKey;
  const srcLabel = r.source || 'internal';
  const dateStr = r.date ? new Date(r.date).toLocaleDateString('en-US', {month:'short', day:'numeric', year:'numeric'}) : 'Recent';

  // Urgency display
  const isCritical = r.urgency === 'critical';
  const isHigh = r.urgency === 'high';
  const urgencyBorder = isCritical ? '3px solid var(--negative)' : isHigh ? '3px solid #e87c2a' : '1px solid var(--border)';
  const urgencyBadge = isCritical
    ? `<div style="display:inline-flex;align-items:center;gap:5px;background:rgba(232,92,92,0.15);border:1px solid rgba(232,92,92,0.45);border-radius:6px;padding:3px 10px;font-size:10px;font-weight:700;color:var(--negative);letter-spacing:0.5px;margin-bottom:10px">
        ğŸš¨ CRITICAL â€” ${r.urgencyReason || 'Immediate Action Required'}
       </div>`
    : isHigh
    ? `<div style="display:inline-flex;align-items:center;gap:5px;background:rgba(232,124,42,0.12);border:1px solid rgba(232,124,42,0.4);border-radius:6px;padding:3px 10px;font-size:10px;font-weight:700;color:#e87c2a;letter-spacing:0.5px;margin-bottom:10px">
        âš ï¸ HIGH PRIORITY â€” ${r.urgencyReason || 'Review Required'}
       </div>`
    : '';

  // Festival tag display
  const festivalBadge = r.festivalTag
    ? `<div style="display:inline-flex;align-items:center;gap:5px;background:rgba(201,168,76,0.12);border:1px solid rgba(201,168,76,0.35);border-radius:6px;padding:3px 10px;font-size:10px;font-weight:600;color:var(--gold);letter-spacing:0.5px;margin-bottom:10px">${r.festivalTag}</div>`
    : '';

  return `
    <div class="review-card" style="border-left:${urgencyBorder}">
      ${urgencyBadge}
      ${festivalBadge}
      <div class="review-card-top">
        <div class="review-author">
          <div class="review-avatar" style="background:${avatarColors[ci]};color:${textColors[ci]}">${initials}</div>
          <div>
            <div class="review-author-name">${r.author || 'Anonymous'}</div>
            <div class="review-meta">${dateStr} <span>Â·</span> <span class="review-source-badge ${srcClass}">${srcLabel}</span></div>
          </div>
        </div>
        <div class="review-right">
          <div class="review-stars" style="color:${r.rating>=4?'var(--gold)':r.rating>=3?'var(--neutral)':'var(--negative)'}">${stars}</div>
        </div>
      </div>
      <div class="review-text">${r.text || 'â€”'}</div>
      <div class="review-footer" style="flex-wrap:wrap;gap:8px">
        <span class="sentiment-pill ${sentClass}">${sentEmoji} ${r.sentiment||'neutral'}</span>
        <div style="display:flex;gap:6px;margin-left:auto;flex-wrap:wrap">
          ${r.requiresAction
            ? `<button class="btn-reply" style="background:${isCritical?'rgba(232,92,92,0.15)':'rgba(232,124,42,0.12)'};border-color:${isCritical?'var(--negative)':'#e87c2a'};color:${isCritical?'var(--negative)':'#e87c2a'}" onclick="openModal('replyModal')">ğŸš¨ Respond Now</button>`
            : `<button class="btn-reply" onclick="openModal('replyModal')">â†© Reply</button>`
          }
          ${(r.rating <= 2 || r.sentiment === 'negative') && !r.alertSent
            ? `<button class="btn-reply" style="border-color:#25d366;color:#25d366" onclick="sendGuestAlertFromCard('${r._id || r.id}', '${(r.author||'').replace(/'/g,'')}')" title="Send WhatsApp/SMS alert to guest">ğŸ“± Send Alert</button>`
            : r.alertSent ? `<span style="font-size:10px;color:#25d366;display:flex;align-items:center;gap:4px">âœ“ Alert sent</span>` : ''
          }
          ${!r.isSpam
            ? `<button class="btn-reply" style="border-color:var(--negative);color:var(--negative)" onclick="reportSpam('${r._id || r.id}')" title="Report as spam">ğŸš« Spam</button>`
            : `<span style="font-size:10px;color:var(--negative);display:flex;align-items:center;gap:4px">ğŸš« Spam</span>`
          }
        </div>
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SPAM & ALERT ACTIONS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

async function reportSpam(reviewId) {
  if (!reviewId || reviewId === 'undefined') { showToast('âš ï¸ Cannot report â€” no review ID (demo data)'); return; }
  try {
    const res = await apiFetch(`${API}/reviews/${reviewId}/report-spam`, { method:'POST' });
    if (res.ok) {
      showToast('ğŸš« Review reported as spam and hidden');
      // Remove card from DOM
      const btn = event.target;
      btn.closest('.review-card').style.opacity = '0.3';
      btn.closest('.review-card').style.pointerEvents = 'none';
      btn.textContent = 'Reported';
    } else { showToast('Failed to report spam'); }
  } catch { showToast('âš ï¸ Server not available â€” spam not saved'); }
}

async function sendGuestAlertFromCard(reviewId, guestName) {
  if (!reviewId || reviewId === 'undefined') {
    showToast('ğŸ“± Demo: Alert would be sent via WhatsApp/SMS (no ID in demo data)'); return;
  }
  const phone = prompt(`Send WhatsApp/SMS alert to ${guestName || 'guest'}\nEnter guest phone number (e.g. +919876543210):`);
  if (!phone) return;
  try {
    const res = await apiFetch(`${API}/alerts/send`, { method:'POST', body: JSON.stringify({ reviewId, guestPhone: phone, guestName }) });
    const data = await res.json();
    if (res.ok) {
      showToast('ğŸ“± Alert sent to guest via WhatsApp/SMS!');
      // Update button in DOM
      if (event.target) { event.target.outerHTML = '<span style="font-size:10px;color:#25d366;display:flex;align-items:center;gap:4px">âœ“ Alert sent</span>'; }
    } else { showToast('Alert failed: ' + (data.error||'unknown error')); }
  } catch { showToast('âš ï¸ Server not available â€” alert not sent'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SPAM PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderSpamPage(container) {
  container.innerHTML = `<div class="loading"><div class="spinner"></div> Loading spam reports...</div>`;
  let spamReviews = [];
  try {
    const res = await apiFetch(`${API}/spam`);
    if (res.ok) spamReviews = await res.json();
  } catch {}

  const MOCK_SPAM = [
    { id:'sp1', author:'Test User', source:'google', rating:5, text:'CALL ME AT +91 9999999999 FOR FREE HOTEL VOUCHERS CLICK HERE https://totally-legit-website-deals.ru/win', date: new Date().toISOString(), spamReasons:['Suspicious URL in review','Suspicious phrase: "call me at"'], hotelName:'W Marriott Juhu' },
    { id:'sp2', author:'Promo Bot', source:'tripadvisor', rating:5, text:'BEST HOTEL EVER!!!!!! AAAAAAAAAAAAAAAAAAA SO AMAZING BOOK NOWWWWWWWWW FREE MONEY EARN $500 WORK FROM HOME', date: new Date(Date.now()-86400000).toISOString(), spamReasons:['Commercial spam keywords','Repeated character spam','Excessive caps'], hotelName:'Marriott Hyderabad' },
    { id:'sp3', author:'Anonymous', source:'internal', rating:1, text:'testing 123', date: new Date(Date.now()-172800000).toISOString(), spamReasons:['Review text too short','Suspicious phrase: "testing 123"'], hotelName:'JW Marriott Bangalore' },
  ];

  const reviews = spamReviews.length > 0 ? spamReviews : MOCK_SPAM;

  container.innerHTML = `
    <div style="background:rgba(232,92,92,0.06);border:1px solid rgba(232,92,92,0.2);border-radius:12px;padding:16px 20px;margin-bottom:24px;display:flex;align-items:center;gap:12px">
      <span style="font-size:20px">ğŸš«</span>
      <div>
        <div style="font-size:13px;font-weight:600;color:var(--negative)">${reviews.length} Spam Review${reviews.length!==1?'s':''} Detected</div>
        <div style="font-size:11px;color:var(--text-muted);margin-top:2px">Auto-detected by keyword analysis, URL detection, character flooding, and rating-sentiment mismatch. Review and dismiss false positives.</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-bottom:24px">
      <div class="dash-stat"><div class="ds-label">Auto-Detected</div><div class="ds-val red">${reviews.filter(r=>!r.spamReasons?.join('').includes('Manually')).length}</div><div class="ds-sub">By spam engine</div></div>
      <div class="dash-stat"><div class="ds-label">Manually Reported</div><div class="ds-val">${reviews.filter(r=>r.spamReasons?.join('').includes('Manually')).length}</div><div class="ds-sub">By team members</div></div>
      <div class="dash-stat"><div class="ds-label">Detection Rules</div><div class="ds-val gold">7</div><div class="ds-sub">Active patterns</div></div>
    </div>

    <div class="panel-section" style="margin-bottom:20px">
      <div class="panel-section-title">ğŸ” Active Detection Rules</div>
      <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:10px">
        ${[
          ['Spam Keywords','Detects commercial spam words (casino, lottery, etc.)'],
          ['Suspicious URLs','Flags reviews with long external links'],
          ['Character Flooding','Catches repeated chars like "aaaaaaa"'],
          ['Excessive Caps','Detects all-caps shouting patterns'],
          ['Repeated Words','Finds word repetition loops'],
          ['Suspicious Phrases','Flags "call me at", "click here", etc.'],
          ['Rating Mismatch','5â˜… with very negative text or 1â˜… with very positive'],
          ['Too Short','Reviews under 10 characters'],
        ].map(([rule,desc]) => `
          <div style="display:flex;align-items:flex-start;gap:10px;padding:10px;background:var(--bg3);border-radius:8px">
            <div style="width:8px;height:8px;border-radius:50%;background:var(--positive);margin-top:4px;flex-shrink:0"></div>
            <div><div style="font-size:12px;font-weight:600;color:var(--text)">${rule}</div><div style="font-size:11px;color:var(--text-muted);margin-top:2px">${desc}</div></div>
          </div>
        `).join('')}
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-section-title">ğŸš« Flagged Reviews</div>
      ${reviews.length === 0
        ? `<div class="empty-state"><div class="empty-state-icon">âœ…</div><div class="empty-state-text">No spam detected. All reviews look clean.</div></div>`
        : `<div class="reviews-container">${reviews.map(r => {
          const dateStr = new Date(r.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
          const srcKey = (r.source||'internal').toLowerCase().replace(/[^a-z]/g,'');
          return `<div class="review-card" style="border-left:3px solid var(--negative);opacity:0.85">
            <div style="display:flex;align-items:flex-start;justify-content:space-between;margin-bottom:10px">
              <div>
                <div style="font-size:12px;font-weight:600;color:var(--text)">${r.hotelName||'Unknown Hotel'} Â· ${r.author||'Anonymous'}</div>
                <div style="font-size:10px;color:var(--text-muted);margin-top:2px">${dateStr} Â· <span class="review-source-badge source-${srcKey}">${r.source}</span></div>
              </div>
              <button onclick="unmarkSpam('${r._id||r.id}')" class="btn-reply" style="border-color:var(--positive);color:var(--positive);font-size:10px">âœ“ Not Spam</button>
            </div>
            <div style="font-size:12px;color:var(--text-dim);line-height:1.6;margin-bottom:10px;padding:10px;background:var(--bg3);border-radius:6px;font-style:italic">"${(r.text||'').substring(0,200)}${r.text?.length>200?'...':''}"</div>
            <div style="display:flex;flex-wrap:wrap;gap:6px">
              ${(r.spamReasons||[]).map(reason => `<span style="font-size:10px;padding:2px 8px;border-radius:10px;background:rgba(232,92,92,0.12);color:var(--negative);border:1px solid rgba(232,92,92,0.25)">âš  ${reason}</span>`).join('')}
            </div>
          </div>`;
        }).join('')}</div>`
      }
    </div>
  `;
}

async function unmarkSpam(reviewId) {
  if (!reviewId || reviewId === 'undefined') { showToast('Demo data â€” no ID to unmark'); return; }
  try {
    const res = await apiFetch(`${API}/reviews/${reviewId}/unmark-spam`, { method:'POST' });
    if (res.ok) { showToast('âœ“ Review restored'); navTo('spam'); }
    else showToast('Failed to unmark');
  } catch { showToast('Server not available'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  DASHBOARD PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderDashboardPage(container) {
  container.innerHTML = `
    <div class="dash-stats">
      <div class="dash-stat">
        <div class="ds-label">Portfolio Rating</div>
        <div class="ds-val gold">4.5</div>
        <div class="ds-sub trend-up">â†‘ +0.2 this quarter</div>
      </div>
      <div class="dash-stat">
        <div class="ds-label">Total Reviews</div>
        <div class="ds-val">24,876</div>
        <div class="ds-sub trend-up">â†‘ +1,243 this month</div>
      </div>
      <div class="dash-stat">
        <div class="ds-label">Response Rate</div>
        <div class="ds-val green">87%</div>
        <div class="ds-sub">Avg. response time: 4.2h</div>
      </div>
      <div class="dash-stat">
        <div class="ds-label">Critical Alerts</div>
        <div class="ds-val red">12</div>
        <div class="ds-sub">Requires immediate action</div>
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-section-title">ğŸ“Š Sentiment Distribution â€” All Properties</div>
      <div style="display:flex;flex-direction:column;gap:12px">
        ${[['Positive','78','var(--positive)'],['Neutral','14','var(--neutral)'],['Negative','8','var(--negative)']].map(([l,v,c])=>`
          <div style="display:flex;align-items:center;gap:14px">
            <div style="width:80px;font-size:12px;color:${c}">${l}</div>
            <div style="flex:1;height:8px;background:var(--bg3);border-radius:4px;overflow:hidden">
              <div style="height:100%;width:${v}%;background:${c};border-radius:4px;transition:width 1s ease"></div>
            </div>
            <div style="width:36px;text-align:right;font-size:12px;font-weight:600;color:${c}">${v}%</div>
          </div>
        `).join('')}
      </div>
    </div>

    <div class="panel-section">
      <div class="panel-section-title">ğŸ† Top Performing Properties</div>
      <div style="display:flex;flex-direction:column;gap:10px">
        ${[
          ['JW Marriott Mumbai Juhu','4.9','â†‘','Mumbai'],
          ['W Mumbai','4.8','â†‘','Mumbai'],
          ['JW Marriott Bengaluru','4.7','â†’','Bengaluru'],
          ['JW Marriott Kolkata','4.6','â†‘','Kolkata'],
          ['Marriott Hyderabad','4.5','â†‘','Hyderabad'],
        ].map(([name, rating, trend, loc], i) => `
          <div style="display:flex;align-items:center;gap:14px;padding:10px 0;border-bottom:1px solid var(--border)">
            <div style="width:24px;font-family:'Cormorant Garamond',serif;font-size:16px;color:${i===0?'var(--gold)':'var(--text-muted)'};font-weight:600">${i+1}</div>
            <div style="flex:1">
              <div style="font-size:13px;font-weight:500;color:var(--text)">${name}</div>
              <div style="font-size:10px;color:var(--text-muted)">${loc}</div>
            </div>
            <div style="font-family:'Cormorant Garamond',serif;font-size:20px;font-weight:600;color:var(--gold)">${rating}</div>
            <div style="font-size:11px;color:${trend==='â†‘'?'var(--positive)':'var(--neutral)'}">${trend}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QUEUE PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQueuePage(container) {
  const queueItems = [
    { hotel: 'JW Marriott Mumbai Juhu', reviewer: 'David Chen', rating: 1, text: 'The room was not cleaned for two days despite multiple requests. The front desk was dismissive and unprofessional. I have never experienced such poor service at a Marriott property.', source: 'google', hours: '2h ago', priority: 'high' },
    { hotel: 'Marriott Pune', reviewer: 'Ananya Sharma', rating: 2, text: 'Booked a suite but was given a standard room with no explanation. When I raised the issue, the manager was rude. This is not the Marriott I know.', source: 'tripadvisor', hours: '5h ago', priority: 'high' },
    { hotel: 'Sheraton Grand Bangalore', reviewer: 'Michael Scott', rating: 3, text: 'Average experience overall. The gym was decent but the pool area was understaffed. Food at the restaurant was okay.', source: 'booking.com', hours: '1d ago', priority: 'medium' },
    { hotel: 'W Mumbai', reviewer: 'Priya Kapoor', rating: 4, text: 'Great stay overall! The design is stunning and the staff were mostly helpful. A few hiccups with room service timing.', source: 'agoda', hours: '1d ago', priority: 'low' },
    { hotel: 'JW Marriott Kolkata', reviewer: 'Robert Williams', rating: 2, text: 'Despite being a Marriott Bonvoy Platinum member, no upgrade was offered. The check-in took 45 minutes. Very disappointing.', source: 'google', hours: '2d ago', priority: 'high' },
    { hotel: 'Marriott Hyderabad', reviewer: 'Sunita Reddy', rating: 3, text: 'The food at the breakfast buffet ran out frequently. Staff were friendly but seemed overwhelmed.', source: 'yelp', hours: '2d ago', priority: 'medium' },
    { hotel: 'JW Marriott Bengaluru', reviewer: 'James Thornton', rating: 1, text: 'Found cockroaches in the bathroom. Completely unacceptable for a 5-star property. Reported to management but no proper compensation was offered.', source: 'tripadvisor', hours: '3d ago', priority: 'high' },
  ];

  container.innerHTML = `
    <div class="dash-stats" style="grid-template-columns:repeat(3,1fr)">
      <div class="dash-stat"><div class="ds-label">Pending Replies</div><div class="ds-val red">7</div></div>
      <div class="dash-stat"><div class="ds-label">High Priority</div><div class="ds-val" style="color:var(--negative)">4</div></div>
      <div class="dash-stat"><div class="ds-label">Avg Wait Time</div><div class="ds-val">14h</div></div>
    </div>
    <div class="reviews-container">
    ${queueItems.map(item => `
        <div class="review-card" style="border-left:3px solid ${item.priority==='high'?'var(--negative)':item.priority==='medium'?'var(--neutral)':'var(--border)'}">
          <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:10px">
            <span style="font-size:11px;font-weight:600;color:var(--text-dim)">${item.hotel}</span>
            <span style="font-size:10px;padding:2px 8px;border-radius:10px;background:${item.priority==='high'?'rgba(232,92,92,0.12)':item.priority==='medium'?'rgba(232,201,122,0.12)':'rgba(78,203,113,0.12)'};color:${item.priority==='high'?'var(--negative)':item.priority==='medium'?'var(--neutral)':'var(--positive)'}">
              ${item.priority.toUpperCase()} PRIORITY
            </span>
          </div>
          <div class="review-card-top">
            <div class="review-author">
              <div class="review-avatar" style="background:rgba(232,92,92,0.15);color:var(--negative)">${item.reviewer.split(' ').map(w=>w[0]).join('')}</div>
              <div>
                <div class="review-author-name">${item.reviewer}</div>
                <div class="review-meta">${item.hours} Â· <span class="review-source-badge source-${item.source.replace('.','')}">${item.source}</span></div>
              </div>
            </div>
            <div class="review-stars" style="color:var(--negative)">${'â˜…'.repeat(item.rating)}${'â˜†'.repeat(5-item.rating)}</div>
          </div>
          <div class="review-text">${item.text}</div>
          <div class="review-footer">
            <span class="sentiment-pill pill-negative">ğŸ˜  Negative</span>
            <button class="btn-reply" onclick="openModal('replyModal')">â†© Reply Now</button>
          </div>
        </div>
      `).join('')}
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ANALYTICS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderAnalyticsPage(container) {
  container.innerHTML = `
    <div class="dash-stats">
      <div class="dash-stat"><div class="ds-label">Avg Rating (6mo)</div><div class="ds-val gold">4.5</div><div class="ds-sub trend-up">â†‘ +0.3 vs previous</div></div>
      <div class="dash-stat"><div class="ds-label">CSAT Score</div><div class="ds-val green">91%</div><div class="ds-sub trend-up">â†‘ +5% this quarter</div></div>
      <div class="dash-stat"><div class="ds-label">Review Volume</div><div class="ds-val">4,123</div><div class="ds-sub">Last 30 days</div></div>
      <div class="dash-stat"><div class="ds-label">Response Rate</div><div class="ds-val">87%</div><div class="ds-sub trend-up">â†‘ +12% from last month</div></div>
    </div>

    <div class="panel-section">
      <div class="panel-section-title">ğŸ“… Monthly Sentiment Trend</div>
      <div style="display:flex;gap:8px;align-items:flex-end;height:120px;margin-top:8px">
        ${[['Sep',68,20,12],['Oct',71,18,11],['Nov',74,17,9],['Dec',70,19,11],['Jan',76,15,9],['Feb',78,14,8]].map(([m,p,n,neg])=>`
          <div style="flex:1;display:flex;flex-direction:column;align-items:center;gap:3px">
            <div style="width:100%;background:var(--bg3);border-radius:4px;overflow:hidden;height:80px;display:flex;flex-direction:column-reverse">
              <div style="background:var(--positive);height:${p}%;transition:height 1s ease"></div>
            </div>
            <div style="font-size:9px;color:var(--text-muted);text-transform:uppercase;letter-spacing:1px">${m}</div>
          </div>
        `).join('')}
      </div>
      <div style="display:flex;gap:16px;margin-top:14px;justify-content:center">
        <div style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-muted)"><div style="width:10px;height:10px;border-radius:50%;background:var(--positive)"></div>Positive</div>
        <div style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-muted)"><div style="width:10px;height:10px;border-radius:50%;background:var(--neutral)"></div>Neutral</div>
        <div style="display:flex;align-items:center;gap:6px;font-size:11px;color:var(--text-muted)"><div style="width:10px;height:10px;border-radius:50%;background:var(--negative)"></div>Negative</div>
      </div>
    </div>

    <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px">
      <div class="panel-section">
        <div class="panel-section-title">ğŸ·ï¸ Category Breakdown</div>
        ${[['ğŸ½ï¸ Food','34%',78],['ğŸ¤ Service','28%',65],['ğŸŠ Amenities','22%',50],['âœ¨ Ambiance','16%',37]].map(([cat,pct,w])=>`
          <div style="margin-bottom:12px">
            <div style="display:flex;justify-content:space-between;font-size:12px;margin-bottom:5px">
              <span>${cat}</span><span style="color:var(--text-muted)">${pct}</span>
            </div>
            <div style="height:6px;background:var(--bg3);border-radius:3px">
              <div style="height:100%;width:${w}%;background:linear-gradient(to right,var(--gold),var(--gold-light));border-radius:3px"></div>
            </div>
          </div>
        `).join('')}
      </div>
      <div class="panel-section">
        <div class="panel-section-title">ğŸ“¡ Platform Distribution</div>
        ${[['Google','38%','#4285f4'],['TripAdvisor','24%','#34a853'],['Booking.com','18%','#0071bb'],['Agoda','12%','var(--gold)'],['Yelp','8%','#d23f31']].map(([src,pct,c])=>`
          <div style="display:flex;align-items:center;gap:10px;margin-bottom:10px">
            <div style="width:80px;font-size:11px;color:${c}">${src}</div>
            <div style="flex:1;height:6px;background:var(--bg3);border-radius:3px">
              <div style="height:100%;width:${pct};background:${c};border-radius:3px"></div>
            </div>
            <div style="width:30px;text-align:right;font-size:11px;color:var(--text-dim)">${pct}</div>
          </div>
        `).join('')}
      </div>
    </div>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALERTS PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
async function renderAlertsPage(container) {
  container.innerHTML = `<div class="loading"><div class="spinner"></div> Loading alerts from MongoDB...</div>`;
  let alerts = [];
  let isLive = false;
  try {
    const res = await apiFetch(`${API}/alerts`);
    if (res.ok) { alerts = await res.json(); isLive = true; }
  } catch {}

  // Fallback mock data if server not running
  if (!alerts.length) {
    alerts = [
      { _id:'mock1', hotelName:'W Marriott Juhu', urgencyReason:'Health & Hygiene Violation', author:'Ananya Singh', text:'Found cockroaches in the bathroom on two consecutive nights. Completely unacceptable. Filing a complaint with the health authorities.', rating:1, urgency:'critical', alertSent:false },
      { _id:'mock2', hotelName:'JW Marriott Bangalore', urgencyReason:'Safety Risk', author:'Rohit Sharma', text:'Fire alarm at 3am with no clear staff evacuation protocol. Guests stood confused for 15+ minutes. Serious safety failure.', rating:1, urgency:'critical', alertSent:false },
      { _id:'mock3', hotelName:'Marriott Pune', urgencyReason:'Major Service Failure', author:'Meera Joshi', text:'Booked a suite for my wedding night â€” given a standard room. Manager refused to rectify. Completely ruined a once-in-a-lifetime occasion.', rating:2, urgency:'critical', alertSent:false },
      { _id:'mock4', hotelName:'JW Marriott Kolkata', urgencyReason:'Loyalty Program Escalation', author:'Vikram Kapoor', text:'Platinum Bonvoy member. No upgrade, no welcome, 45-minute check-in. Will be escalating to Marriott corporate.', rating:2, urgency:'high', alertSent:false },
      { _id:'mock5', hotelName:'W Mumbai', urgencyReason:'Security Incident', author:'Priya Nair', text:'Wallet went missing from the room. Security team was unhelpful and dismissive. A police report has been filed.', rating:1, urgency:'critical', alertSent:false },
      { _id:'mock6', hotelName:'Marriott Hyderabad', urgencyReason:'Allergen Failure', author:'Deepa Nambiar', text:'Family member had allergic reaction after a nut-free dish contained nuts. No manager came. Escalating to FSSAI.', rating:1, urgency:'critical', alertSent:false },
      { _id:'mock7', hotelName:'Sheraton Grand Bangalore', urgencyReason:'Social Media Exposure', author:'Kavya Reddy', text:'Posted about my filthy room on Instagram â€” already 8,000 views. Stained carpet, unemptied bin, used towel from previous guest.', rating:2, urgency:'high', alertSent:false },
      { _id:'mock8', hotelName:'Marriott Hotel New Delhi', urgencyReason:'Infrastructure Safety', author:'Arjun Mehta', text:'Elevator stuck 25 minutes with my elderly mother inside. Emergency phone non-functional. Completely unacceptable.', rating:1, urgency:'critical', alertSent:false },
    ];
  }

  // Track sent state in memory for mock data
  if (!window._alertSentState) window._alertSentState = {};

  container.innerHTML = `
    ${!isLive ? `<div style="background:rgba(232,201,122,0.08);border:1px solid rgba(232,201,122,0.25);border-radius:10px;padding:10px 16px;margin-bottom:16px;font-size:11px;color:var(--neutral);display:flex;align-items:center;gap:8px">
      <span>âš ï¸</span> Server offline â€” showing demo data. Start <code>node server.js</code> to use live MongoDB data.
    </div>` : ''}
    <div style="background:rgba(232,92,92,0.08);border:1px solid rgba(232,92,92,0.25);border-radius:12px;padding:16px 20px;margin-bottom:24px;display:flex;align-items:center;justify-content:space-between;gap:12px">
      <div style="display:flex;align-items:center;gap:12px">
        <span style="font-size:20px">ğŸš¨</span>
        <div>
          <div style="font-size:13px;font-weight:600;color:var(--negative)">${alerts.length} Critical Reviews Require Immediate Action</div>
          <div style="font-size:11px;color:var(--text-muted);margin-top:2px">Flagged based on rating (1â€“2 stars), safety risks, hygiene violations, or loyalty escalations. WhatsApp alerts can be sent to guests below via WhatsApp Business API.</div>
        </div>
      </div>
      <div style="text-align:right">
        <div style="font-size:11px;color:#25d366;font-weight:600" id="alertSentCounter">${alerts.filter(a=>a.alertSent||window._alertSentState[a._id]).length} / ${alerts.length}</div>
        <div style="font-size:10px;color:var(--text-muted)">Alerts sent</div>
      </div>
    </div>
    <div class="reviews-container">
      ${alerts.map(a => {
        const isCrit = a.urgency === 'critical';
        const stars = 'â˜…'.repeat(a.rating) + 'â˜†'.repeat(5-a.rating);
        const wasSent = a.alertSent || window._alertSentState[a._id];
        const safeId = String(a._id).replace(/'/g, '');
        const safeName = (a.author||'Guest').replace(/'/g, '').replace(/"/g, '');
        const safeHotel = (a.hotelName||'').replace(/'/g, '').replace(/"/g, '');
        return `
        <div class="review-card" id="alertCard_${safeId}" style="border-left:3px solid ${isCrit?'var(--negative)':'#e87c2a'}">
          <div style="display:inline-flex;align-items:center;gap:5px;background:${isCrit?'rgba(232,92,92,0.15)':'rgba(232,124,42,0.12)'};border:1px solid ${isCrit?'rgba(232,92,92,0.4)':'rgba(232,124,42,0.4)'};border-radius:6px;padding:3px 10px;font-size:10px;font-weight:700;color:${isCrit?'var(--negative)':'#e87c2a'};margin-bottom:10px">
            ${isCrit?'ğŸš¨ CRITICAL':'âš ï¸ HIGH PRIORITY'} â€” ${a.urgencyReason||'Review Required'}
          </div>
          <div style="display:flex;justify-content:space-between;margin-bottom:10px">
            <div style="font-size:13px;font-weight:600;color:var(--text)">${a.hotelName} Â· <span style="font-size:12px;color:var(--text-dim)">by ${a.author||'Guest'}</span></div>
            <div class="review-stars" style="color:var(--negative)">${stars}</div>
          </div>
          <div class="review-text">${a.text}</div>
          <div class="review-footer" style="flex-wrap:wrap;gap:8px">
            <span style="font-size:10px;color:var(--text-muted)">${a.date ? new Date(a.date).toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'}) : 'Recent'}</span>
            <div style="display:flex;gap:6px;margin-left:auto" id="alertBtns_${safeId}">
              <button class="btn-reply" style="background:${isCrit?'rgba(232,92,92,0.15)':'rgba(232,124,42,0.12)'};border-color:${isCrit?'var(--negative)':'#e87c2a'};color:${isCrit?'var(--negative)':'#e87c2a'}" onclick="openModal('replyModal')">ğŸš¨ Respond</button>
              ${wasSent
                ? `<span class="alert-sent-badge">âœ“ Alert sent</span>`
                : `<button class="btn-reply" style="border-color:#25d366;color:#25d366" onclick="openAlertModal('${safeId}','${safeName}','${safeHotel}',${a.rating})">ğŸ“± Send Alert</button>`
              }
            </div>
          </div>
        </div>`;
      }).join('')}
    </div>
  `;
}

// â”€â”€ Alert modal state â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let _currentAlertReviewId = null;
let _currentAlertMeta = {};

function openAlertModal(reviewId, guestName, hotelName, rating) {
  _currentAlertReviewId = reviewId;

  const stars = 'â˜…'.repeat(rating) + 'â˜†'.repeat(5 - rating);
  const message = [
    `Dear ${guestName || 'Valued Guest'},`,
    '',
    `Thank you for your feedback about ${hotelName} (${stars}).`,
    '',
    'We sincerely apologize your experience did not meet our standards. Our management team is personally reviewing your case and will reach out within 24 hours.',
    '',
    'Immediate support:',
    'ğŸ“ 1800-123-4567 (toll-free)',
    'âœ‰ï¸ guestrelations@marriott.com',
    '',
    'Thank you for helping us improve.',
    '',
    'â€” Marriott Guest Relations',
  ].join('\n');

  _currentAlertMeta = { reviewId, guestName, hotelName, rating, message };

  // Populate guest info
  document.getElementById('alertGuestName').textContent = guestName || 'Guest';
  document.getElementById('alertHotelName').textContent = hotelName;
  document.getElementById('alertStarsDisplay').innerHTML = `<span style="color:var(--negative)">${stars}</span>`;
  document.getElementById('alertRatingLabel').textContent = rating + '/5 stars';
  document.getElementById('alertMsgText').textContent = message;

  // Reset form state
  document.getElementById('alertPhoneInput').value = '';
  document.getElementById('alertPhoneHint').textContent = "Indian 10-digit numbers get +91 added automatically";
  document.getElementById('alertPhoneHint').style.color = 'var(--text-muted)';
  document.getElementById('alertStatusMsg').style.display = 'none';
  document.getElementById('btnSendAlert').disabled = false;
  document.getElementById('btnSendLabel').textContent = 'Send WhatsApp';

  // Load saved credentials into panel fields
  const creds = loadCreds();
  document.getElementById('credWaToken').value  = creds.waToken  || '';
  document.getElementById('credPhoneId').value  = creds.phoneId  || '';

  // Check if server is online to decide whether to show creds panel
  fetch(`${API}/hotels/search?q=`, { signal: AbortSignal.timeout(1500) })
    .then(() => {
      // Server online â€” hide creds panel
      document.getElementById('waCredsPanel').style.display = 'none';
      document.getElementById('waStatusDot').style.background = '#25d366';
      document.getElementById('waStatusLabel').textContent = 'Server online';
      document.getElementById('waStatusLabel').style.color = '#25d366';
    })
    .catch(() => {
      // Server offline â€” show creds panel
      document.getElementById('waCredsPanel').style.display = 'block';
      updateWAStatus(creds);
    });

  document.getElementById('alertModal').classList.add('open');
  setTimeout(() => document.getElementById('alertPhoneInput').focus(), 200);
}

function validateAlertPhone() {
  const val = document.getElementById('alertPhoneInput').value.trim();
  const hint = document.getElementById('alertPhoneHint');
  const cleaned = val.replace(/[\s\-()]/g, '');
  if (!cleaned) {
    hint.textContent = 'Indian numbers: enter 10 digits and we\'ll add +91 automatically';
    hint.style.color = 'var(--text-muted)';
  } else if (/^\d{10}$/.test(cleaned)) {
    hint.textContent = 'âœ“ Will send to +91' + cleaned;
    hint.style.color = 'var(--positive)';
  } else if (/^\+\d{10,15}$/.test(cleaned)) {
    hint.textContent = 'âœ“ Valid international number';
    hint.style.color = 'var(--positive)';
  } else if (cleaned.length > 0 && cleaned.length < 10) {
    hint.textContent = 'âš  Too short â€” need at least 10 digits';
    hint.style.color = 'var(--neutral)';
  } else {
    hint.textContent = 'Enter with country code: +919876543210';
    hint.style.color = 'var(--text-muted)';
  }
}

// â”€â”€ WhatsApp Business API credential helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
const CREDS_KEY = 'marriott_wa_creds';

function loadCreds() {
  try { return JSON.parse(localStorage.getItem(CREDS_KEY) || '{}'); } catch { return {}; }
}
function saveCreds() {
  const creds = {
    waToken:  document.getElementById('credWaToken').value.trim(),
    phoneId:  document.getElementById('credPhoneId').value.trim(),
  };
  localStorage.setItem(CREDS_KEY, JSON.stringify(creds));
  updateWAStatus(creds);
}
function hasCreds(c) { return c && c.waToken && c.phoneId; }
function updateWAStatus(creds) {
  const dot   = document.getElementById('waStatusDot');
  const label = document.getElementById('waStatusLabel');
  if (!dot || !label) return;
  if (hasCreds(creds)) {
    dot.style.background = '#25d366';
    label.textContent = 'WhatsApp API ready';
    label.style.color = '#25d366';
  } else {
    dot.style.background = '#e8c97a';
    label.textContent = 'WA API not configured';
    label.style.color = 'var(--neutral)';
  }
}
function toggleCredsPanel() {
  const body  = document.getElementById('credsPanelBody');
  const arrow = document.getElementById('credsPanelArrow');
  const hidden = body.style.display === 'none';
  body.style.display = hidden ? 'block' : 'none';
  arrow.textContent  = hidden ? 'â–²' : 'â–¼';
}

// â”€â”€ Direct WhatsApp Business API send from browser (server-offline fallback) â”€
async function sendViaWADirect(phone, message, creds) {
  // Uses WhatsApp Business Cloud API directly from browser
  const to = phone.replace(/[\s\-()]/g, '').replace(/^\+/, ''); // strip + for WA API
  try {
    const res = await fetch(
      `https://graph.facebook.com/v19.0/${creds.phoneId}/messages`,
      {
        method: 'POST',
        headers: {
          'Authorization': `Bearer ${creds.waToken}`,
          'Content-Type':  'application/json',
        },
        body: JSON.stringify({
          messaging_product: 'whatsapp',
          to,
          type: 'text',
          text: { body: message },
        }),
      }
    );
    const data = await res.json();
    if (data.messages?.[0]?.id) {
      return [{ channel:'whatsapp', status:'sent', wamid: data.messages[0].id }];
    } else {
      const err = data.error?.message || JSON.stringify(data);
      const code = data.error?.code;
      return [{ channel:'whatsapp', status:'failed', error: err, code }];
    }
  } catch(e) {
    return [{ channel:'whatsapp', status:'failed', error: e.message }];
  }
}

async function confirmSendAlert() {
  const rawPhone = document.getElementById('alertPhoneInput').value.trim();
  if (!rawPhone) {
    document.getElementById('alertPhoneHint').textContent = 'âš  Please enter a phone number';
    document.getElementById('alertPhoneHint').style.color = 'var(--negative)';
    return;
  }

  const { reviewId, guestName, hotelName, rating, message } = _currentAlertMeta;
  const btn = document.getElementById('btnSendAlert');
  btn.disabled = true;
  document.getElementById('btnSendLabel').textContent = 'Sending...';
  const statusEl = document.getElementById('alertStatusMsg');
  statusEl.style.display = 'none';

  // Normalize phone
  const cleaned = rawPhone.replace(/[\s\-()]/g, '');
  const phone = cleaned.startsWith('+') ? cleaned : (cleaned.length === 10 ? '+91' + cleaned : '+' + cleaned);

  const isMock = String(reviewId).startsWith('mock');

  // â”€â”€ Try server first â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  let serverOnline = false;
  try {
    const endpoint = isMock ? `${API}/alerts/send-direct` : `${API}/alerts/send`;
    const payload  = isMock
      ? { guestPhone: phone, guestName, hotelName, rating: parseInt(rating) }
      : { reviewId, guestPhone: phone, guestName };
    const res  = await apiFetch(endpoint, { method:'POST', body: JSON.stringify(payload) });
    const data = await res.json();
    serverOnline = true;
    if (res.ok) { _handleAlertSuccess(reviewId); return; }
    else { _handleAlertError(data.error || 'Server error', btn); return; }
  } catch (_) { /* server offline â€” fall through */ }

  // â”€â”€ Server offline: try browser-direct WhatsApp API â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  if (!serverOnline) {
    const creds = loadCreds();
    if (!hasCreds(creds)) {
      // Show creds panel so user can enter credentials
      document.getElementById('waCredsPanel').style.display = 'block';
      statusEl.style.display = 'block';
      statusEl.style.background = 'rgba(201,168,76,0.1)';
      statusEl.style.border = '1px solid rgba(201,168,76,0.3)';
      statusEl.style.color = 'var(--neutral)';
      statusEl.innerHTML =
        `<strong>âš ï¸ Server is offline.</strong> Enter your WhatsApp Business API credentials above to send directly from the browser, or start <code>node server.js</code>.`;
      btn.disabled = false;
      document.getElementById('btnSendLabel').textContent = 'Send WhatsApp';
      return;
    }

    // Has creds â€” send direct from browser
    document.getElementById('btnSendLabel').textContent = 'Sending via WhatsApp...';
    try {
      const results = await sendViaWADirect(phone, message, creds);
      const sent    = results.filter(r => r.status === 'sent');
      const failed  = results.filter(r => r.status === 'failed');

      if (sent.length > 0) {
        _handleAlertSuccess(reviewId);
        if (failed.length > 0) {
          showToast('âš ï¸ Sent on ' + sent.map(r=>r.channel).join('+') + ' but ' + failed.map(r=>r.channel+' failed: '+r.error).join('; '));
        }
        return;
      }

      // All failed
      const errDetail = failed.map(r => `${r.channel}: ${r.error}`).join('\n');
      statusEl.style.display = 'block';
      statusEl.style.background = 'rgba(232,92,92,0.1)';
      statusEl.style.border = '1px solid rgba(232,92,92,0.3)';
      statusEl.style.color = 'var(--negative)';
      // Common WhatsApp API errors with helpful explanations
      let hint = '';
      if (errDetail.includes('131047') || errDetail.includes('not opted')) {
        hint = '<br><span style="font-size:10px;opacity:0.8">ğŸ’¡ Recipient not opted in. Have them send you a WhatsApp message first, or use a pre-approved template.</span>';
      } else if (errDetail.includes('100') || errDetail.includes('Invalid')) {
        hint = '<br><span style="font-size:10px;opacity:0.8">ğŸ’¡ Check your Phone Number ID â€” it should be a numeric ID, not the phone number itself.</span>';
      } else if (errDetail.includes('190') || errDetail.includes('expired')) {
        hint = '<br><span style="font-size:10px;opacity:0.8">ğŸ’¡ Token expired. Get a new token at developers.facebook.com â†’ Your App â†’ WhatsApp â†’ API Setup.</span>';
      }
      statusEl.innerHTML = `<strong>âŒ Failed to send:</strong><br><code style="font-size:10px">${errDetail.replace(/\n/g,'<br>')}</code>${hint}`;
      btn.disabled = false;
      document.getElementById('btnSendLabel').textContent = 'Send WhatsApp';
    } catch(e) {
      _handleAlertError('Browser send error: ' + e.message, btn);
    }
  }
}

function _handleAlertSuccess(reviewId) {
  // Mark as sent in memory
  if (!window._alertSentState) window._alertSentState = {};
  window._alertSentState[reviewId] = true;

  // Update the button in place â€” no full page reload
  const btnsEl = document.getElementById('alertBtns_' + reviewId);
  if (btnsEl) {
    const oldBtn = btnsEl.querySelector('button[style*="25d366"]');
    if (oldBtn) {
      const badge = document.createElement('span');
      badge.className = 'alert-sent-badge';
      badge.textContent = 'âœ“ Alert sent';
      oldBtn.replaceWith(badge);
    }
  }

  // Update counter
  const counter = document.getElementById('alertSentCounter');
  if (counter) {
    const parts = counter.textContent.split(' / ');
    counter.textContent = (parseInt(parts[0]) + 1) + ' / ' + parts[1];
  }

  closeModal('alertModal');
  showToast('âœ… WhatsApp message sent to guest!');
}

function _handleAlertError(msg, btn) {
  const statusEl = document.getElementById('alertStatusMsg');
  statusEl.style.display = 'block';
  statusEl.style.background = 'rgba(232,92,92,0.1)';
  statusEl.style.border = '1px solid rgba(232,92,92,0.3)';
  statusEl.style.color = 'var(--negative)';
  statusEl.textContent = 'âŒ ' + msg;
  btn.disabled = false;
  document.getElementById('btnSendLabel').textContent = 'Send WhatsApp';
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MOCK DATA GENERATOR â€” Rich dataset with urgency/priority flags
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function generateMockReviewsFrontend(hotelName, count) {
  const templates = {
    food: {
      positive: [
        'The breakfast buffet was phenomenal! Fresh ingredients and an exceptional variety of dishes. Absolutely worth every rupee.',
        'Fine dining at its absolute best. The signature restaurant at this property exceeded every single one of my expectations.',
        'Best hotel breakfast I\'ve had anywhere in India. The chefs clearly take immense pride in their craft.',
        'Room service arrived promptly and every item was delicious. The truffle risotto is simply unmissable.',
        'The Sunday brunch spread was world-class. Live counters, fresh seafood, and desserts that were works of art.',
        'Had the most memorable dinner at the in-house restaurant. The butter chicken and dal makhani were extraordinary.',
        'The poolside grill exceeded all expectations. Fresh grilled fish with herb butter â€” exquisite.',
        'Afternoon tea was an experience in itself â€” delicate finger sandwiches, freshly baked scones, and premium Darjeeling.',
        'Chef\'s Table experience was exceptional. A seven-course tasting menu with wine pairings â€” absolutely flawless.',
        'The Japanese restaurant on the 3rd floor is hidden gem. Sushi quality rivaled any top restaurant in Tokyo.',
        'Loved the local Indian breakfast counter. Idli, dosa, poha â€” all made fresh and served piping hot.',
        'The pizzas from the all-day dining were surprisingly authentic. Thin crust, perfect char, great toppings.',
      ],
      negative: [
        'Breakfast was cold and the selection was very limited for a 5-star property. Highly disappointing.',
        'Room service took 90 minutes and when it arrived, everything was lukewarm. Called three times with no update.',
        'The restaurant menu is overpriced for mediocre quality. Expected significantly better from a Marriott property.',
        'My dietary restrictions were completely ignored despite informing staff twice at check-in. Found meat in a dish I requested vegetarian.',
        'The coffee at breakfast was undrinkably bitter. Had to use the Nespresso machine in my room instead.',
        'Mini bar was not restocked for two consecutive days. When I called, I was told it would be done "shortly" â€” it never was.',
        'The all-day dining menu has not changed in years. I stay here regularly and the lack of variety is becoming an issue.',
        'Found a hair in my soup. When I informed the waiter, there was no apology and no replacement offered.',
        'Restaurant took 40 minutes to acknowledge us. The host seemed unaware of our reservation despite confirmation.',
      ],
      neutral: [
        'The food was decent â€” standard hotel fare. Nothing extraordinary but satisfactory.',
        'Breakfast was adequate but I expected more variety at this price point.',
        'Room service was fine. Average taste, decent presentation, reasonable speed.',
        'The restaurant is good for a quick meal but not a dining destination in itself.',
        'Menu variety is acceptable. Would be nice to see more regional Indian options.',
        'Food quality has been consistent across my stays. Reliable if not exciting.',
      ],
    },
    ambiance: {
      positive: [
        'The lobby design is absolutely stunning. The architecture alone makes it worth a visit even if you\'re not staying.',
        'The rooftop bar offers the most spectacular panoramic city views I have ever seen from any hotel.',
        'Interior design is exquisite â€” every corner has been thoughtfully and beautifully curated.',
        'The golden hour view from the pool deck is breathtaking. Stayed longer than planned just to take it all in.',
        'The heritage wing has been restored with incredible care and attention to architectural detail.',
        'Mood lighting throughout the property is perfectly calibrated â€” warm and luxurious without feeling garish.',
        'The lobby garden atrium is a serene oasis in the middle of a chaotic city. Truly special.',
        'Art installations in the corridors are curated beautifully. Feels more like a gallery than a hotel hallway.',
        'The spa\'s relaxation lounge is one of the most tranquil spaces I have encountered anywhere in the world.',
        'The bar\'s live jazz creates the perfect atmosphere for a late evening drink. Loved every minute.',
      ],
      negative: [
        'The lobby was extremely noisy. Construction happening right outside made relaxation completely impossible.',
        'My room faced the parking lot. For this price point, a decent view should be guaranteed.',
        'The renovation has left several common areas looking unfinished. Scaffolding in the lobby is not a good look.',
        'The hallways on floors 4â€“6 smell musty. Likely a ventilation issue that needs immediate attention.',
        'Bar lighting is so dim that reading the menu is genuinely difficult. Style over substance.',
        'The pool area is sandwiched between two noisy function halls. Not the peaceful retreat advertised.',
        'The much-advertised garden suite had a view of a concrete wall. Felt completely misrepresented.',
      ],
      neutral: [
        'Pleasant atmosphere â€” standard for a hotel in this category.',
        'Tasteful decor, nothing that particularly sets it apart from competitors.',
        'The aesthetic is safe and inoffensive. Not particularly inspiring, but not unpleasant either.',
        'Common areas are well maintained. No complaints but nothing remarkable.',
        'Design is consistent with the Marriott brand standard. Exactly what you would expect.',
      ],
    },
    amenities: {
      positive: [
        'The spa experience was world-class. My hot stone massage was one of the best I\'ve ever had anywhere.',
        'State-of-the-art fitness center with every piece of equipment you could possibly need. Open 24/7 â€” a lifesaver on business trips.',
        'Heated infinity pool, impeccable towel service, Molton Brown toiletries â€” pure, unapologetic luxury.',
        'The business centre was fully equipped and private. Perfect for back-to-back calls during my conference week.',
        'Club lounge access was exceptional value. Evening cocktails and canapÃ©s were genuinely high quality.',
        'The pillow menu is a thoughtful touch. The memory foam option gave me the best hotel sleep I can remember.',
        'Complimentary pressing service for suits was handled perfectly. Clothes came back immaculate.',
        'Concierge arranged a private car and city tour that was better than any travel agency could have managed.',
        'The kids\' club kept my children entertained for hours. Well-supervised, creative activities all day.',
        'In-room technology was seamless â€” tablet control, blackout blinds, sound system all worked perfectly.',
        'Golf simulator on the 14th floor was a delightful surprise. Spent two hours there before my early morning meeting.',
      ],
      negative: [
        'Several gym machines were out of order during my entire three-day stay. No apology or alternative offered.',
        'The pool was closed without any prior notice. Found out only when I arrived with my family in swimwear.',
        'WiFi dropped constantly during my work calls. For a business hotel, this is completely unacceptable.',
        'The sauna had a broken temperature control. Staff said they were aware of the issue but had no timeline for repair.',
        'Spa bookings were unavailable for my entire stay. Apparently fully booked, but no one mentioned this at check-in.',
        'The Club lounge was overcrowded during evening hours. No seating available and drinks ran out before 7pm.',
        'Elevator wait times were excessive â€” upwards of 8 minutes at peak hours. Needs urgent attention.',
        'The executive floor butler service I paid extra for was rarely available. Could not locate anyone for three hours.',
        'Business centre computers were running outdated software. Printer jammed and no one came to fix it.',
        'Pool towels ran out by 11am on weekends. Completely inadequate for the number of guests.',
      ],
      neutral: [
        'Standard amenities â€” adequate gym, functional pool. Nothing that particularly stands out.',
        'WiFi was workable, not blazing fast. Pool area could benefit from more loungers.',
        'The spa offers a reasonable range of treatments. Pricing is on the higher side for what is offered.',
        'Business facilities are functional. Meeting room was clean and well-lit.',
        'Amenities are consistent with the brand standard. No surprises in either direction.',
        'Club lounge was decent. Selection was good but not exceptional during my stay.',
      ],
    },
    service: {
      positive: [
        'The concierge went above and beyond to arrange a last-minute anniversary dinner. Truly extraordinary.',
        'Staff remembered my name and coffee preference from day one and maintained that throughout my stay. Remarkable.',
        'Housekeeping was thoughtful and thorough. The little handwritten note and chocolates each evening were a lovely touch.',
        'Check-in was seamless â€” room was ready 3 hours early and I was escorted personally by the duty manager.',
        'The front desk proactively upgraded my room upon arrival. No request needed. Simply outstanding.',
        'Bell staff helped me navigate a missed connecting flight. They went far beyond their job description.',
        'The GM personally called to wish me on my birthday. That level of personalised attention is exceptional.',
        'Maintenance came within 12 minutes of my call and fixed the AC issue completely. Zero disruption.',
        'Butler service in the suite was flawless â€” attentive without being intrusive. Perfect calibration.',
        'Room service order was wrong but the correction arrived in under 15 minutes with a complimentary dessert.',
        'The hostess at breakfast remembered my dietary preferences from the previous day without any prompting.',
        'Security team handled a minor disturbance on my floor with complete discretion and professionalism.',
      ],
      negative: [
        'Waited 45 minutes at check-in despite no visible queue. Staff appeared completely disorganised.',
        'Front desk was cold and dismissive when I raised a legitimate concern. Completely contrary to Marriott standards.',
        'Housekeeping entered my room without knocking despite a Do Not Disturb sign clearly displayed on the door.',
        'My wake-up call was missed. Caused me to be late for a crucial business meeting. No acknowledgement from management.',
        'Concierge gave me wrong directions and refused to accept responsibility when I returned late.',
        'Requested a hypoallergenic pillow at check-in and again at 9pm. It never arrived. My allergies acted up all night.',
        'Staff at the pool bar ignored us for 20 minutes despite making eye contact multiple times.',
        'The valet returned my car with a new scratch on the rear bumper. Management initially disputed it before reviewing CCTV.',
        'Night manager was dismissive when I reported a loud party on my floor at 2am. Issue persisted for another hour.',
        'Check-out bill had three extra charges. Getting them reversed took over 40 minutes of back-and-forth.',
        'Loyalty membership benefits were not applied despite providing my Bonvoy number at booking. Had to escalate.',
        'Two separate staff members gave me conflicting information about the checkout time. Caused unnecessary stress.',
      ],
      neutral: [
        'Service was professional but felt automated, lacking genuine personal warmth.',
        'Staff were helpful enough but interactions felt transactional throughout.',
        'Check-in was efficient if not particularly warm. Got everything needed without delay.',
        'Service levels are consistent across the property â€” no highs or lows to speak of.',
        'The team is competent and well-trained. Would benefit from more personalisation.',
        'Housekeeping was regular and thorough. Nothing to complain about.',
      ],
    },
  };

  // Urgency templates â€” these will be flagged as high-importance
  const urgentTemplates = [
    { text: 'URGENT: Found cockroaches in the bathroom on two consecutive nights. Completely unacceptable for a property of this standing. I am filing a formal complaint with the health authorities.', category: 'amenities', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Health & Hygiene Violation' },
    { text: 'The fire alarm went off at 3am and staff had no clear evacuation protocol. Guests were left confused in the corridor for over 15 minutes. This is a serious safety concern.', category: 'service', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Safety Risk' },
    { text: 'There was mould visible on the bathroom ceiling and around the shower tiles. My children stayed in this room. I expect an immediate response and a full refund.', category: 'amenities', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Health & Hygiene Violation' },
    { text: 'The AC in my room leaked water onto the floor overnight. I slipped and nearly fell. No one came despite calling the front desk three times. Demand immediate remedy.', category: 'amenities', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Safety Risk' },
    { text: 'A family member had an allergic reaction after eating a dish that was supposed to be nut-free. Staff showed no urgency and no manager came to speak with us. Escalating to Bonvoy corporate.', category: 'food', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Health & Safety â€” Allergen Failure' },
    { text: 'I am a Platinum Bonvoy member and was treated with complete disregard. No upgrade, no welcome amenity, and the duty manager refused to meet with me. I will be requesting a full audit of my stay.', category: 'service', sentiment: 'negative', urgency: 'high', urgencyReason: 'Loyalty Program Escalation' },
    { text: 'Posted a photo of my filthy room on Instagram â€” already has 5,000 views. The carpet had visible stains, the bin had not been emptied, and there was a used towel left from the previous guest.', category: 'amenities', sentiment: 'negative', urgency: 'high', urgencyReason: 'Social Media Exposure Risk' },
    { text: 'The roof of the pool changing room collapsed partially while guests were inside. No one was injured but this could have been catastrophic. Management needs to address this immediately.', category: 'amenities', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Infrastructure Safety' },
    { text: 'Booked a suite for my wedding night â€” was given a standard room. Manager refused to rectify. This completely ruined a once-in-a-lifetime occasion. I expect a full refund and a formal apology.', category: 'service', sentiment: 'negative', urgency: 'high', urgencyReason: 'Major Service Failure' },
    { text: 'My wallet went missing from the room. The safe was functioning but valuables left on the desk disappeared. I have filed a police complaint. The hotel\'s security team was unhelpful and dismissive.', category: 'service', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Security Incident' },
    { text: 'Received a bill for someone else\'s minibar charges and massage bookings. Total overbilling of over â‚¹18,000. This may be a data breach issue. Raising formally with my bank and the hotel management.', category: 'service', sentiment: 'negative', urgency: 'high', urgencyReason: 'Billing / Potential Data Issue' },
    { text: 'The elevator got stuck for 25 minutes with my elderly mother inside. Emergency phone inside was not working. Completely unacceptable maintenance and emergency response failure.', category: 'amenities', sentiment: 'negative', urgency: 'critical', urgencyReason: 'Safety â€” Equipment Failure' },
    // â”€â”€ Festival / Occasion Reviews â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    { text: 'Celebrated Diwali here with the whole family â€” 12 of us! The hotel had decorated the entire lobby with diyas and marigold garlands. The special thali dinner was outstanding, and they even arranged a small fireworks display from the terrace. Truly a Diwali to remember. Will make this our annual tradition.', category: 'ambiance', sentiment: 'positive', urgency: null, urgencyReason: null, festivalTag: 'ğŸª” Diwali Stay' },
    { text: 'Stayed over Navratri and was blown away by the Garba night they organised in the banquet hall. The dhol players were excellent, staff joined in the dancing, and the Gujarati thali was the best I have had outside Ahmedabad. Even the room corridors had dandiya decorations. Absolutely brilliant effort.', category: 'food', sentiment: 'positive', urgency: null, urgencyReason: null, festivalTag: 'ğŸ¶ Navratri Celebration' },
    { text: 'Brought my parents here to celebrate Eid. The hotel had a special Eid brunch with sewaiyan, biryani, and live qawwali music in the evening. The staff wished us warmly and the room had a small gift basket. These thoughtful touches mean the world during a festival. Highly recommended for families.', category: 'food', sentiment: 'positive', urgency: null, urgencyReason: null, festivalTag: 'ğŸŒ™ Eid Celebration' },
    { text: 'Spent Holi weekend here and the hotel organised the most joyful colour celebration I have experienced. Organic colours, a massive lawn party, live dhol, chilled thandai, and gujiya platters everywhere. Staff were fully participative and nothing was too much trouble. Truly spectacular. Already booked for next year.', category: 'ambiance', sentiment: 'positive', urgency: null, urgencyReason: null, festivalTag: 'ğŸ¨ Holi Weekend' },
    { text: 'We checked in for Dussehra and were pleasantly surprised by the Ramlila performance organised in the courtyard. The kids were completely mesmerised. The hotel also decorated the rooms with flowers and left a box of motichoor laddoos. Small gesture, massive impact. The spirit of the festival was very much alive here.', category: 'ambiance', sentiment: 'positive', urgency: null, urgencyReason: null, festivalTag: 'âœ¨ Dussehra Stay' },
  ];

  const names = [
    'Arjun Mehta','Priya Nair','Rohit Sharma','Sneha Iyer','Vikram Kapoor',
    'Kavya Reddy','Aditya Kumar','Meera Joshi','Dhruv Malhotra','Ananya Singh',
    'Siddharth Rao','Tanvi Desai','Karan Shah','Ishaan Gupta','Pooja Verma',
    'Rajesh Pillai','Deepa Nambiar','Suresh Krishnan','Lakshmi Venkat','Mohan Iyer',
    'Chetan Bhatt','Ritu Agarwal','Nikhil Bose','Swati Pandey','Gaurav Chawla',
    'Nisha Patel','Abhishek Tiwari','Shruti Menon','Varun Bhatia','Divya Shetty',
    'Harish Murthy','Neha Jain','Pranav Kulkarni','Sunita Rao','Amit Mishra',
    'Pallavi Nair','Manish Dubey','Kritika Singh','Samir Khanna','Anjali Kapoor',
    'Raghav Pillai','Shreya Ghosh','Vivek Thakur','Namrata Shah','Kunal Bajaj',
    'Preeti Chauhan','Rishabh Verma','Sonam Agarwal','Tarun Banerjee','Reena Misra',
  ];

  const sources = ['google','tripadvisor','booking.com','agoda','yelp','marriott.com','expedia'];
  const cats = ['food','ambiance','amenities','service'];
  const sentimentWeights = ['positive','positive','positive','positive','neutral','neutral','negative'];

  const reviews = [];
  const targetCount = Math.max(count, 120); // Always generate a rich dataset

  // Inject urgent reviews first (sprinkled in)
  const urgentCount = Math.min(urgentTemplates.length, Math.floor(targetCount * 0.12));
  for (let u = 0; u < urgentCount; u++) {
    const tpl = urgentTemplates[u];
    reviews.push({
      id: 'urgent_' + u,
      source: sources[Math.floor(Math.random() * sources.length)],
      author: names[Math.floor(Math.random() * names.length)],
      rating: tpl.urgency === 'critical' ? 1 : tpl.sentiment === 'positive' ? 5 : 2,
      text: tpl.text,
      date: new Date(Date.now() - u * 86400000 * Math.ceil(Math.random() * 4)).toISOString(),
      sentiment: tpl.sentiment,
      categories: [tpl.category],
      urgency: tpl.urgency || null,
      urgencyReason: tpl.urgencyReason || null,
      festivalTag: tpl.festivalTag || null,
      requiresAction: !!tpl.urgency,
    });
  }

  // Fill remaining with regular reviews
  for (let i = 0; i < targetCount - urgentCount; i++) {
    const cat = cats[i % cats.length];
    const sent = sentimentWeights[i % sentimentWeights.length];
    const pool = templates[cat][sent];
    const text = pool[i % pool.length];

    // Occasionally flag a high-importance non-urgent review
    const isHighImportance = (sent === 'negative') && (i % 11 === 0);

    reviews.push({
      id: 'mock_' + i,
      source: sources[i % sources.length],
      author: names[i % names.length],
      rating: sent==='positive' ? (Math.random()>0.3?5:4) : sent==='negative' ? (Math.random()>0.4?1:2) : 3,
      text,
      date: new Date(Date.now() - (i + urgentCount) * 86400000 * (1 + Math.random() * 2)).toISOString(),
      sentiment: sent,
      categories: [cat],
      urgency: isHighImportance ? 'high' : null,
      urgencyReason: isHighImportance ? 'Repeated Negative Pattern' : null,
      requiresAction: isHighImportance,
    });
  }

  return reviews;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  QR COLLECTOR PAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function renderQRPage(container) {
  const hotels = getMockHotels('');
  const internalReviews = getInternalReviews();
  const recentCount = internalReviews.length;

  container.innerHTML = `
    <div style="max-width:820px">
      <div class="dash-stats" style="grid-template-columns:repeat(3,1fr);margin-bottom:28px">
        <div class="dash-stat"><div class="ds-label">Internal Reviews</div><div class="ds-val gold">${recentCount}</div><div class="ds-sub">Via QR form</div></div>
        <div class="dash-stat"><div class="ds-label">Hotels with QR</div><div class="ds-val">10</div><div class="ds-sub">All properties active</div></div>
        <div class="dash-stat"><div class="ds-label">Form URL</div><div class="ds-val" style="font-size:13px;color:var(--text-dim)">review-form.html</div><div class="ds-sub">Scan to open on mobile</div></div>
      </div>

      <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:28px">

        <!-- QR Generator panel -->
        <div class="panel-section">
          <div class="panel-section-title">ğŸ“± Generate QR Code</div>
          <div style="margin-bottom:14px">
            <div class="section-label" style="font-size:10px;letter-spacing:2px;text-transform:uppercase;color:var(--text-muted);margin-bottom:8px">Select Property</div>
            <select class="form-select" id="qrHotelSelect" onchange="updateQRCode()">
              ${hotels.map(h => `<option value="${h.id}">${h.name}</option>`).join('')}
            </select>
          </div>
          <div style="background:white;border-radius:12px;padding:20px;display:flex;align-items:center;justify-content:center;margin-bottom:14px">
            <div id="qrCodeDisplay" style="text-align:center"></div>
          </div>
          <div style="text-align:center;margin-bottom:14px">
            <div style="font-size:12px;color:var(--text-dim)" id="qrUrlLabel">review-form.html?hotel=mh001</div>
          </div>
          <div style="display:flex;gap:8px">
            <button class="btn-secondary" style="flex:1;text-align:center" onclick="openFormInNewTab()">ğŸ”— Open Form</button>
            <button class="btn-primary" style="flex:1;text-align:center" onclick="printQR()">ğŸ–¨ Print QR</button>
          </div>
        </div>

        <!-- Recent internal submissions -->
        <div class="panel-section">
          <div class="panel-section-title">ğŸ“¬ Recent Submissions</div>
          <div id="internalReviewsList" style="max-height:340px;overflow-y:auto">
            ${renderInternalReviewsList(internalReviews.slice(0,6))}
          </div>
          ${recentCount > 0 ? `<div style="margin-top:12px;text-align:center"><button class="btn-secondary" onclick="clearInternalReviews()">ğŸ—‘ Clear All Demo Reviews</button></div>` : ''}
        </div>
      </div>

      <!-- Instructions -->
      <div class="panel-section">
        <div class="panel-section-title">ğŸ“‹ How It Works</div>
        <div style="display:grid;grid-template-columns:repeat(4,1fr);gap:16px">
          ${[
            ['1', 'ğŸ“±', 'Guest scans QR', 'At the table, reception, or room via NFC/QR'],
            ['2', 'ğŸ“', 'Fills the form', 'Selects hotel, rates experience, picks category & sub-topics'],
            ['3', 'âš¡', 'Auto-detected', 'Sentiment is detected live as they type'],
            ['4', 'ğŸ“Š', 'Added to dashboard', 'Appears instantly in Hotel Detail under the right category'],
          ].map(([n,icon,title,desc]) => `
            <div style="text-align:center;padding:8px">
              <div style="width:28px;height:28px;border-radius:50%;background:var(--gold-dim);border:1px solid var(--gold);display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:600;color:var(--gold);margin:0 auto 10px">${n}</div>
              <div style="font-size:20px;margin-bottom:6px">${icon}</div>
              <div style="font-size:12px;font-weight:600;color:var(--text);margin-bottom:4px">${title}</div>
              <div style="font-size:10px;color:var(--text-muted);line-height:1.5">${desc}</div>
            </div>
          `).join('')}
        </div>
      </div>
    </div>
  `;

  // Render initial QR
  setTimeout(() => updateQRCode(), 50);
}

function renderInternalReviewsList(reviews) {
  if (!reviews.length) return `<div class="empty-state" style="padding:30px 10px"><div class="empty-state-icon">ğŸ“­</div><div class="empty-state-text">No internal reviews yet.<br>Share the QR code with guests!</div></div>`;
  return reviews.map(r => {
    const sentColor = r.sentiment === 'positive' ? 'var(--positive)' : r.sentiment === 'negative' ? 'var(--negative)' : 'var(--neutral)';
    const stars = 'â˜…'.repeat(r.rating) + 'â˜†'.repeat(5 - r.rating);
    const timeAgo = formatTimeAgo(r.date);
    const catIcon = {food:'ğŸ½ï¸',ambiance:'âœ¨',amenities:'ğŸŠ',service:'ğŸ¤'}[r.categories?.[0]] || 'ğŸ“';
    return `<div style="padding:12px 0;border-bottom:1px solid var(--border)">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:4px">
        <span style="font-size:12px;font-weight:500;color:var(--text)">${r.author || 'Guest'}</span>
        <span style="font-size:11px;color:var(--gold)">${stars}</span>
      </div>
      <div style="font-size:10px;color:var(--text-muted);margin-bottom:5px">${catIcon} ${r.categories?.[0] || 'general'} ${r.subCategories?.length ? 'Â· ' + r.subCategories[0] : ''} Â· ${timeAgo}</div>
      <div style="font-size:11px;color:var(--text-dim);line-height:1.5;display:-webkit-box;-webkit-line-clamp:2;-webkit-box-orient:vertical;overflow:hidden">${r.text}</div>
      ${r.staffMentioned ? `<div style="font-size:10px;color:var(--gold-light);margin-top:3px">ğŸ‘¤ ${r.staffMentioned}</div>` : ''}
    </div>`;
  }).join('');
}

function formatTimeAgo(dateStr) {
  const diff = Date.now() - new Date(dateStr).getTime();
  const m = Math.floor(diff / 60000);
  if (m < 1) return 'Just now';
  if (m < 60) return m + 'm ago';
  const h = Math.floor(m / 60);
  if (h < 24) return h + 'h ago';
  return Math.floor(h/24) + 'd ago';
}

function updateQRCode() {
  const sel = document.getElementById('qrHotelSelect');
  if (!sel) return;
  const hotelId = sel.value;
  const url = `review-form.html?hotel=${hotelId}`;
  const displayEl = document.getElementById('qrCodeDisplay');
  const labelEl = document.getElementById('qrUrlLabel');
  if (labelEl) labelEl.textContent = url;

  // Generate QR using free public API (no key needed)
  const qrApiUrl = `https://api.qrserver.com/v1/create-qr-code/?size=180x180&data=${encodeURIComponent(window.location.origin + '/' + url)}&bgcolor=ffffff&color=0d1219&qzone=2&margin=0`;
  if (displayEl) {
    displayEl.innerHTML = `
      <img src="${qrApiUrl}" alt="QR Code" style="width:180px;height:180px;border-radius:8px;display:block;margin:0 auto"
           onerror="this.replaceWith(getFallbackQR('${hotelId}'))">
      <div style="margin-top:10px;font-size:10px;color:#888;letter-spacing:1.5px;text-transform:uppercase">Scan to Review</div>
    `;
  }
}

function getFallbackQR(hotelId) {
  // Render a simple SVG QR placeholder if API fails
  const d = document.createElement('div');
  d.innerHTML = `<svg width="180" height="180" viewBox="0 0 180 180" style="border-radius:8px">
    <rect width="180" height="180" fill="white"/>
    <rect x="10" y="10" width="60" height="60" rx="4" fill="none" stroke="#0d1219" stroke-width="4"/>
    <rect x="20" y="20" width="40" height="40" fill="#0d1219" rx="2"/>
    <rect x="28" y="28" width="24" height="24" fill="white" rx="1"/>
    <rect x="110" y="10" width="60" height="60" rx="4" fill="none" stroke="#0d1219" stroke-width="4"/>
    <rect x="120" y="20" width="40" height="40" fill="#0d1219" rx="2"/>
    <rect x="128" y="28" width="24" height="24" fill="white" rx="1"/>
    <rect x="10" y="110" width="60" height="60" rx="4" fill="none" stroke="#0d1219" stroke-width="4"/>
    <rect x="20" y="120" width="40" height="40" fill="#0d1219" rx="2"/>
    <rect x="28" y="128" width="24" height="24" fill="white" rx="1"/>
    <text x="90" y="95" text-anchor="middle" fill="#c9a84c" font-size="22" font-weight="bold" font-family="serif">M</text>
    <rect x="80" y="105" width="20" height="2" fill="#c9a84c"/>
  </svg>`;
  return d.firstElementChild;
}

function openFormInNewTab() {
  const sel = document.getElementById('qrHotelSelect');
  const hotelId = sel ? sel.value : 'mh001';
  window.open(`review-form.html?hotel=${hotelId}`, '_blank');
}

function printQR() {
  window.open(`review-form.html`, '_blank');
}

// â”€â”€ Internal review storage â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function getInternalReviews() {
  try {
    return JSON.parse(localStorage.getItem('marriott_internal_reviews') || '[]');
  } catch { return []; }
}

function clearInternalReviews() {
  localStorage.removeItem('marriott_internal_reviews');
  navTo('qrcollect');
}

// â”€â”€ Inject internal reviews into hotel detail â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function mergeInternalReviews(hotelId, reviews) {
  const internal = getInternalReviews().filter(r => r.hotelId === hotelId);
  // Mark internal reviews
  internal.forEach(r => { r.source = 'internal'; });
  // Deduplicate by id
  const existingIds = new Set(reviews.map(r => r.id));
  const fresh = internal.filter(r => !existingIds.has(r.id));
  return [...fresh, ...reviews]; // internal first = newest
}
function openModal(id) {
  document.getElementById(id).classList.add('open');
}
function closeModal(id) {
  document.getElementById(id).classList.remove('open');
}
function selectTemplate(el, text) {
  document.querySelectorAll('.template-btn').forEach(t => t.classList.remove('selected'));
  el.classList.add('selected');
  document.getElementById('replyText').value = text;
}
function sendReply() {
  closeModal('replyModal');
  document.getElementById('replyText').value = '';
  document.querySelectorAll('.template-btn').forEach(t => t.classList.remove('selected'));
  showToast('âœ“ Reply sent successfully');
}
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// Close modal on overlay click
document.getElementById('replyModal').addEventListener('click', e => {
  if (e.target === e.currentTarget) closeModal('replyModal');
});
</script>
</body>
</html>

